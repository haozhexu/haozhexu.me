<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ruby Notes | Haozhe XU</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/apps/">Apps</a></li>
      
      <li><a href="/poems/">Poem / 诗词</a></li>
      
      <li><a href="/article">Article</a></li>
      
      <li><a href="/categories/">Categories</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/cn/">简体中文</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Ruby Notes</span></h1>

<h2 class="date">2020/07/19</h2>
</div>

<main>
<h1 id="ruby-notes">Ruby Notes</h1>
<p>This is the notes I&rsquo;ve taken while reading the book &ldquo;The Well-Grounded Rubyist&rdquo;, I tried to make it useful as a reference but do not expect this to be a well-written tutorial for beginners.</p>
<p><a href="#basics">Basics</a><br>
<a href="#objects-methods-and-local-variables">Objects, methods and local variables</a><br>
<a href="#classes">Classes</a><br>
<a href="#modules">Modules</a><br>
<a href="#default-object-scope-and-visibility">Default object, scope and visibility</a><br>
<a href="#control-flow">Control Flow</a><br>
<a href="#built-in-basics">Built-in basics</a><br>
<a href="#strings-symbols-and-other-scalar-objects">Strings, symbols and other scalar objects</a><br>
<a href="#collection-and-container-objects">Collection and container objects</a><br>
<a href="#enumerable-and-enumerator">Enumerable and Enumerator</a><br>
<a href="#regular-expression">Regular Expression</a><br>
<a href="#file-and-io">File and IO</a></p>
<h2 id="basics">Basics</h2>
<h3 id="basic-operations">Basic operations</h3>
<ul>
<li>arithmetic: <code>+, -, *, /</code>, mixing integers and floating-point numbers would proce floating-point result.</li>
<li>assignment: <code>x = 3</code>, <code>text = &quot;Hi&quot;</code></li>
<li>comparison: <code>x == y</code></li>
<li>conversion: <code>x = &quot;100&quot;.to_i</code>, <code>x = s.to_i</code></li>
</ul>
<h3 id="basic-io">Basic I/O:</h3>
<ul>
<li><code>print &quot;Hi&quot;</code>: prints the text and leaves the cursor at the end</li>
<li><code>puts &quot;Hi&quot;</code>: prints the text and adds a new line if there isn&rsquo;t one</li>
<li><code>x = &quot;Hi&quot;</code>, <code>p x</code>: outputs an <em>inspect</em> string which may contain extra information</li>
<li><code>gets</code>, <code>text = gets</code>: get a line of keyboard input</li>
</ul>
<h3 id="special-objects">Special Objects</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">true</span>
<span style="color:#66d9ef">false</span>
<span style="color:#66d9ef">nil</span>
self
</code></pre></div><p>For conditional expression, both <code>false</code> and <code>nil</code> is evaluated as <code>false</code>.</p>
<p>Comments are ignored by the interpreter:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># a line of comment</span>
x <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e"># inline comment</span>
</code></pre></div><h3 id="convention">Convention</h3>
<p>Note: I&rsquo;ve seen coding conventions that are different from below, so either agree to a convention from the beginning, or use whatever convention that&rsquo;s already been adopted in existing code.</p>
<ul>
<li><em>Local Variables</em>: start with a lowercase letter or an underscore, consists of letters, underscores and/or digits. <code>x</code>, <code>first_name</code></li>
<li><em>Instance Variables</em>: stores information within individual objects, always start with a single at-sign (@) and consist of the same character set as local variable. <code>@age</code>, <code>@level</code></li>
<li><em>Class Variables</em>: store information per class, follow the same rule as instance variable except that they start with two at-signs. <code>@@total_score</code></li>
<li><em>Global Variables</em>: start with a dollar sign. <code>$FILE_PATH</code></li>
<li><em>Constants</em>: begin with an uppercase letter. e.g. <code>FirstName</code>, <code>LOAD_PATH</code></li>
<li><em>Method Names</em>: they follow the same rule as local variables, and this is on purpose so that the concept of methods is the same as variables as expression that provide a value</li>
</ul>
<h3 id="objects">Objects</h3>
<p>If you know what OO is, the idea of <em>Objects</em> in Ruby is very straightforward:</p>
<ul>
<li><em>almost</em> everything in Ruby are objects</li>
<li>every object is capable of receiving a certain set of <em>messages</em></li>
<li>each <em>message</em> correspond to a <em>method</em></li>
</ul>
<p>e.g.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;100&#34;</span><span style="color:#f92672">.</span>to_i
y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;120&#34;</span><span style="color:#f92672">.</span>to_i(<span style="color:#ae81ff">9</span>)
puts <span style="color:#e6db74">&#34;Hi&#34;</span> <span style="color:#75715e"># bareword-style invocation</span>
</code></pre></div><h2 id="installation-package-version">Installation, Package, Version</h2>
<p>Sometimes it&rsquo;s useful to have multiple Ruby version installed, to check current configuration, load a library package called <code>rbconfig</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">irb <span style="color:#f92672">--</span>simple<span style="color:#f92672">-</span>prompt <span style="color:#f92672">-</span>r rbconfig
<span style="color:#f92672">&gt;&gt;</span> <span style="color:#66d9ef">RbConfig</span><span style="color:#f92672">::</span><span style="color:#66d9ef">CONFIG</span><span style="color:#f92672">[</span>term<span style="color:#f92672">]</span>
</code></pre></div><p>Directories lookup for <em>term</em>:</p>
<table>
<thead>
<tr>
<th>Term</th>
<th>Directory contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>rubylibdir</td>
<td>Ruby standard library</td>
</tr>
<tr>
<td>bindir</td>
<td>Ruby command-line tools</td>
</tr>
<tr>
<td>archdir</td>
<td>Architecture-specific extensions and libraries</td>
</tr>
<tr>
<td>sitedir</td>
<td>Your own or third-party extensions and libraries</td>
</tr>
<tr>
<td>vendordir</td>
<td>Third-party extensions and libraries (in Ruby)</td>
</tr>
<tr>
<td>sitelibdir</td>
<td>Your own Ruby language extensions (in Ruby)</td>
</tr>
<tr>
<td>sitearchdir</td>
<td>Your own Ruby language extensions (in C)</td>
</tr>
</tbody>
</table>
<p>Check default load paths:</p>
<p><code>ruby -e 'puts $:'</code></p>
<p><code>-e</code> means inline script to the interpreter</p>
<ul>
<li><code>load</code> is a command for loading library. <code>load &quot;../extras.rb&quot;</code></li>
<li><code>require</code> a <em>feature</em> only load it once, unlike <code>load</code>. <code>require &quot;../extras&quot;</code></li>
<li><code>require_relative</code> loads features by searching relative to the running directory</li>
</ul>
<h3 id="ruby-tools-and-applications">Ruby tools and applications</h3>
<ul>
<li>ruby - interpreter</li>
<li>irb - interactive Ruby interpreter</li>
<li>rdoc and ri - Ruby documentation tools</li>
<li>rake - Ruby make, a task-management utility</li>
<li>gem - a Ruby library and application package-management utility</li>
<li>erb - a templating system</li>
</ul>
<h4 id="interpreter-command-line-arguments">Interpreter command-line arguments</h4>
<table>
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-c</code></td>
<td>checks the syntax of a program file without executing it, usually used in conjunction with <code>-w</code></td>
</tr>
<tr>
<td><code>-w</code></td>
<td>gives warning messages during program execution</td>
</tr>
<tr>
<td><code>-e</code></td>
<td>executes the code provided in quotation marks on the command line, for multiple lines use literal line breaks (ie. Enter) or semicolons</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>line mode: prints a newline after every line of output</td>
</tr>
<tr>
<td><code>rname</code></td>
<td>requires the named feature, <code>ruby -rscanf</code></td>
</tr>
<tr>
<td><code>-v</code></td>
<td>shows Ruby version and executes the program in verbose mode</td>
</tr>
<tr>
<td><code>--version</code></td>
<td>shows Ruby version information</td>
</tr>
<tr>
<td><code>-h</code></td>
<td>shows information about all command-line switches for the interpreter</td>
</tr>
</tbody>
</table>
<h4 id="rake">rake</h4>
<p><code>rake</code> provides functionalities similar to <code>make</code>, it reads and executes tasks defined in file, <code>Rakefile</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Ruby" data-lang="Ruby">namespace <span style="color:#e6db74">:project</span> <span style="color:#66d9ef">do</span>
  desc <span style="color:#e6db74">&#34;Clean files temporarily generated during building&#34;</span>
  task <span style="color:#e6db74">:clean</span> <span style="color:#66d9ef">do</span>
    <span style="color:#75715e"># cleaning</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>perform the task: <code>rake project:clean</code></li>
<li>list all defined tasks: <code>rake --tasks</code></li>
<li>namespace can have any depth: <code>rake project:build:prod</code></li>
</ul>
<h4 id="gem">gem</h4>
<p><code>gem install library</code></p>
<ul>
<li><code>gem</code> downloads gem files as needed from rubygems.org</li>
<li>files in <code>.gem</code> format saved in cache subdirectory of gems directory</li>
<li>you can also install a gem on your hard disk: <code>gem install /home/me/mygems/something.gem</code></li>
<li>providing a gem without full filename would look for it in current directory and local cache, also searches remotely for dependencies unless providing <code>-l</code> command-line flag</li>
<li>to uninstall a gem, use <code>gem uninstall gemname</code></li>
<li>once a gem is installed, you can <code>require</code> it</li>
</ul>
<h2 id="objects-methods-and-local-variables">Objects, methods and local variables</h2>
<h3 id="generic-object">Generic Object</h3>
<ul>
<li>Generic object doesn&rsquo;t represent or model anything specific</li>
<li>Created by <code>Object.new</code></li>
<li>There&rsquo;s also <code>BasicObject</code> which is more basic</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">robot <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">robot</span><span style="color:#f92672">.</span><span style="color:#a6e22e">talk</span>
  puts <span style="color:#e6db74">&#34;I am a robot&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>now we can send <em>message</em> to the object: <code>robot.talk</code></li>
</ul>
<h4 id="methods-that-take-arguments">Methods that take arguments</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">robot</span><span style="color:#f92672">.</span><span style="color:#a6e22e">c2f</span>(c)
  c <span style="color:#f92672">*</span> <span style="color:#ae81ff">9</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>now we can ask <code>robot</code> to convert celsius to fahrenheit: <code>puts robot.c2f(100)</code></li>
<li>parentheses are optional when there&rsquo;s a direct correspondence between parameters and method</li>
<li>define: <code>def robot.c2f c</code></li>
<li>call: <code>robot.c2f 100</code></li>
<li>keyword <code>return</code> is optional but sometimes necessary, e.g. <code>return a, b, c</code> would wrap the values in an array, equivalent to <code>[a, b, c]</code> without <code>return</code></li>
</ul>
<h4 id="another-example-product">Another Example: Product</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">product <span style="color:#f92672">=</span> <span style="color:#66d9ef">Object</span><span style="color:#f92672">.</span>new

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">product</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span>
  <span style="color:#e6db74">&#34;A Robot&#34;</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">product</span><span style="color:#f92672">.</span><span style="color:#a6e22e">full_description</span>
  <span style="color:#e6db74">&#34;A Robot that can Talk&#34;</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">product</span><span style="color:#f92672">.</span><span style="color:#a6e22e">is_complete?</span>
  <span style="color:#66d9ef">false</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>a method of a boolean value ends with a question mark so it can be used as a condition like asking a question</li>
<li>everything in Ruby has a Boolean value, and sometimes it&rsquo;s not what you might expect</li>
</ul>
<h4 id="built-in-methods-of-an-object">Built-in Methods of an Object</h4>
<p>To see a list of innate methods of object:</p>
<p><code>p Object.new.methods.sort</code></p>
<ul>
<li><code>object_id</code> can be used to uniquely identify objects, it&rsquo;s like a reference to object</li>
<li><code>respond_to?</code> can be used to check if object can respond to a message. <code>robot.respond_to?(&quot;talk&quot;)</code></li>
<li><code>send</code> can be used to send message to an object. <code>robot.send(&quot;talk&quot;)</code></li>
<li><code>__send__</code> is an alternative way to call <code>send</code>, it avoid conflict with dev defined <code>send</code></li>
<li>there&rsquo;s also the <code>public_send</code> which cannot call the object&rsquo;s private methods</li>
</ul>
<h3 id="method-arguments">Method Arguments</h3>
<ul>
<li>providing wrong numbers of arguments yields: <code>ArgumentError</code></li>
<li>optional argument starts with a star: <code>def multi_args(*x)</code></li>
<li>arguments can have default values <code>def default_args(a,b,c=1)</code></li>
<li>Ruby tries to assign values to as many variables as possible</li>
<li>you can&rsquo;t put the argument sponge to the left of any default-valued arguments</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mixed_args</span>(a,b,<span style="color:#f92672">*</span>c,d)
  puts <span style="color:#e6db74">&#34;Arguments:&#34;</span>
  p a,b,c,d
<span style="color:#66d9ef">end</span>

mixed_args(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>)
<span style="color:#75715e"># Arguments:</span>
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># 2</span>
<span style="color:#75715e"># [3, 4]</span>
<span style="color:#75715e"># 5</span>

mixed_args(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># 2</span>
<span style="color:#75715e"># []</span>
<span style="color:#75715e"># 3</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">args_unleashed</span>(a,b<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">*</span>c,d,e)
  p a,b,c,d,e
<span style="color:#66d9ef">end</span>

args_unleashed(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>)
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># 2</span>
<span style="color:#75715e"># [3]</span>
<span style="color:#75715e"># 4</span>
<span style="color:#75715e"># 5</span>

args_unleashed(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># []</span>
<span style="color:#75715e"># 2</span>
<span style="color:#75715e"># 3</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">broken_args</span>(x,<span style="color:#f92672">*</span>y,z<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>once given x its argument and sponged up all the remaining arguments in y, nothing can be left for z</li>
<li>if z gets the right-hand argument, leaving the rest for y, it makes no sense to describe z as &ldquo;optional&rdquo; or &ldquo;default-valued&rdquo;</li>
</ul>
<h3 id="local-variables-and-assignment">Local variables and assignment</h3>
<ul>
<li>local variables have limited <em>scope</em></li>
<li>most variables in Ruby hold <em>references</em> to objects</li>
<li>immediate values: integers, <code>true</code>, <code>false</code> and <code>nil</code></li>
<li>you can&rsquo;t do this: <code>x = 1; x++</code></li>
<li><code>dup</code> method duplicates an object, preventing original object from being changed inside methods</li>
<li><code>freeze</code> method freezes an object, prevents it from being changed at all</li>
<li>there is no way to unfreeze</li>
<li><code>clone</code> is similar to <code>dup</code>, except the <code>clone</code> of a frozen object will also be frozen, but not the case with <code>dup</code></li>
</ul>
<h2 id="classes">Classes</h2>
<ul>
<li>classes usually exist for the purpose of being <em>instantiated</em></li>
<li>classes are objects, the <code>new</code> method is a <em>constructor</em> whose purpose is to create and return a new instance of the class</li>
<li>classes are defined with <code>class</code> keyword, named with <em>constants</em></li>
<li><em>instance methods</em> will be shared by all instances</li>
<li>define the same method multiple times would <em>override</em></li>
<li>reopen a class by <code>class [ClassName]</code> with additions or changes</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Robot</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
    <span style="color:#e6db74">&#34;A Robot&#34;</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
    <span style="color:#e6db74">&#34;B Robot&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

robot <span style="color:#f92672">=</span> <span style="color:#66d9ef">Robot</span><span style="color:#f92672">.</span>new
puts robot<span style="color:#f92672">.</span>name

<span style="color:#75715e"># reopen class</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Robot</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">age</span>
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">10</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="instance-variables">Instance Variables</h3>
<ul>
<li>you can have constructor <code>initialize</code> with arguments</li>
<li>Ruby allows you to define methods that end with an equal sign</li>
<li>with syntactic sugar, method call is like assignment</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Robot</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(name,age)
    @name <span style="color:#f92672">=</span> name
    @age <span style="color:#f92672">=</span> age
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>
    @name
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">age</span>
    @age
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_older</span>
    @age <span style="color:#f92672">=</span> @age <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cost</span><span style="color:#f92672">=</span>(amount)
    @cost <span style="color:#f92672">=</span> amount
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cost</span>
    @cost
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

robot <span style="color:#f92672">=</span> <span style="color:#66d9ef">Robot</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;A Robot&#34;</span>, <span style="color:#ae81ff">11</span>)
robot<span style="color:#f92672">.</span>cost<span style="color:#f92672">=</span>(<span style="color:#ae81ff">100</span><span style="color:#f92672">.</span><span style="color:#ae81ff">00</span>)
<span style="color:#75715e"># syntactic sugar</span>
robot<span style="color:#f92672">.</span>cost <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span><span style="color:#f92672">.</span><span style="color:#ae81ff">00</span>
</code></pre></div><ul>
<li>Ruby provides shortcuts for writing getters and setters</li>
<li>an <em>attribute</em> is a property of an object whose value can be read and/or written through the object</li>
<li>Ruby offers <code>attr_reader</code> and <code>attr_writer</code> for defining readable and writable attributes.</li>
<li>for read-write attributes, use <code>attr_accessor</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Robot</span>
  <span style="color:#66d9ef">attr_reader</span> <span style="color:#e6db74">:name</span>, <span style="color:#e6db74">:age</span>, <span style="color:#e6db74">:cost</span>
  <span style="color:#66d9ef">attr_writer</span> <span style="color:#e6db74">:cost</span>
  <span style="color:#75715e"># same as:</span>
  <span style="color:#66d9ef">attr_reader</span> <span style="color:#e6db74">:name</span>, <span style="color:#e6db74">:age</span>
  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:cost</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="inheritance">Inheritance</h3>
<ul>
<li><em>single inheritance</em>: every Ruby class can have only one superclass</li>
<li>every class is either a subclass of <code>Object</code>, or a sub-subclass of <code>Object</code></li>
<li>classes are special objects which have the power to create new instances</li>
<li>class can be created the same we as other objects: <code>Class.new</code></li>
<li>you can add instance methods to a class when it&rsquo;s created</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SmartRobot</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Robot</span>
  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:ai</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">c <span style="color:#f92672">=</span> <span style="color:#66d9ef">Class</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">say_hi</span>
    puts <span style="color:#e6db74">&#34;Hi!&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

c<span style="color:#f92672">.</span>new<span style="color:#f92672">.</span>say_hi
</code></pre></div><h3 id="singleton-method-class-method">Singleton Method, Class Method</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Robot</span><span style="color:#f92672">.</span><span style="color:#a6e22e">most_expensive</span>(<span style="color:#f92672">*</span>robots)
  robots<span style="color:#f92672">.</span>max_by(<span style="color:#f92672">&amp;</span><span style="color:#e6db74">:cost</span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li><code>&amp;:</code> is often used with the map method</li>
</ul>
<h3 id="constants">Constants</h3>
<ul>
<li>name of constants begins with a capital letter</li>
<li>constant lookup notation: a double colon (<code>::</code>), <code>Robot::MODELS</code></li>
</ul>
<h2 id="modules">Modules</h2>
<ul>
<li><code>Class</code> class is a subclass of the <code>Module</code> class, every class object is also a module object</li>
<li><code>Kernel</code> module contains majority of the methods common to all objects</li>
<li>modules don&rsquo;t have instances, they get <em>mixed in</em> to classes using <code>include</code> or <code>prepend</code></li>
<li>more than one module can be mixed in, no class can inherit from more than one class</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">module</span> MyModule
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ruby_version</span>
    system(<span style="color:#e6db74">&#34;ruby -v&#34;</span>)
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">MyModule</span>
<span style="color:#66d9ef">end</span>
obj <span style="color:#f92672">=</span> <span style="color:#66d9ef">MyClass</span><span style="color:#f92672">.</span>new
obj<span style="color:#f92672">.</span>ruby_version
</code></pre></div><p>e.g. a simple FILO stack module</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">module</span> Stacklike
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stack</span>
    @stack <span style="color:#f92672">||=</span> <span style="color:#f92672">[]</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(obj)
    stack<span style="color:#f92672">.</span>push(obj)
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">take</span>
    stack<span style="color:#f92672">.</span>pop
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">require_relative <span style="color:#e6db74">&#34;stacklike&#34;</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Stack</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Stacklike</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li><code>require</code> and <code>load</code> take strings as their arguments</li>
<li><code>include</code> takes the name of a module in the form of a constant</li>
<li><code>require</code> and <code>load</code> are locating and loading disk files</li>
<li><code>include</code>, <code>extend</code> and <code>prepend</code> perform a program-space, in-memory operation</li>
<li>a common sequence is to <code>require</code> a file then <code>include</code> a module defined in the file</li>
<li>convention: class name is a noun whereas module&rsquo;s name is an adjective, e.g. <code>Stack</code> objects are <code>stacklike</code></li>
<li>by mixin a module into a class, class can define domain language appropriate for the class</li>
</ul>
<h3 id="method-lookup">Method Lookup</h3>
<p>When an object is sent a message:</p>
<ul>
<li>does the object&rsquo;s class have such method?</li>
<li>does the object&rsquo;s class mixin any modules that have such method?</li>
<li>does the object&rsquo;s class&rsquo; superclass define such method?</li>
<li>does the object&rsquo;s class&rsquo; superclass mixin any module that define such method?</li>
<li>if not found, a special method <code>method_missing</code> is called</li>
<li>if method-lookup path includes two or more same-named method, the first one encountered is executed</li>
<li>if a class mixes in two or more modules with duplicated methods, the one in most recently mixed-in module is used</li>
<li>mixin a module more than once is ignored, and has no effect in term of the order of method-lookup</li>
<li><code>include</code> vs <code>prepend</code>: method lookup searches the module first if module is <code>prepend</code></li>
<li><code>include</code> vs <code>extend</code>: <code>extend</code> makes a module&rsquo;s method available as class methods</li>
<li>use <code>super</code> to jump up to the next-highest definition in the method lookup path</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">module</span> M
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">report</span>
    puts <span style="color:#e6db74">&#34;&#39;report&#39; method in module M&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
  <span style="color:#66d9ef">include</span> M
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">report</span>
    puts <span style="color:#e6db74">&#34;&#39;report&#39; method in class C&#34;</span>
    <span style="color:#66d9ef">super</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>How <code>super</code> handles arguments:</p>
<ul>
<li>without argument list, <code>super</code> automatically forwards the arguments passed to the method from which <code>super</code> is called</li>
<li>with empty argument list, ie. <code>super()</code>, sends no arguments to the higher-up method</li>
<li>with specific arguments, e.g. <code>super(a, b, c)</code>, sends exactly those arguments</li>
<li>the method <code>method</code> returns an instance of the methods, e.g. <code>obj.method(:method)</code></li>
<li><code>super_method</code> returns an instance of the super method, e.g. <code>obj.method(:method).super_method</code></li>
<li><code>Kernel</code> module provides an instance method <code>method_missing(m, *args)</code></li>
</ul>
<p>Module can be used to organize code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">module</span> Tools
  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hammer</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

h <span style="color:#f92672">=</span> <span style="color:#66d9ef">Tools</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Hammer</span><span style="color:#f92672">.</span>new
</code></pre></div><h2 id="default-object-scope-and-visibility">Default object, scope and visibility</h2>
<ul>
<li><code>self</code> at the top level is the default default object, <code>main</code></li>
<li><code>self</code> inside a class definition is the class object itself</li>
<li><code>self</code> inside any method is the object to which the message was sent</li>
<li><code>self</code> inside a class method is the class object</li>
<li><code>self</code> inside an instance method is the instance of the class</li>
</ul>
<p>Alternative ways of defining class methods:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">x</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
  <span style="color:#66d9ef">class</span> <span style="color:#f92672">&lt;&lt;</span> self
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">x</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="scope-and-variables">Scope and Variables</h3>
<h4 id="global">Global</h4>
<ul>
<li><em>global scope</em> covers the entire program, global variables are recognizable by initial dollar-sign</li>
<li>Ruby has a large number of global variables initialized on start
<ul>
<li><code>$:</code> contains the directories that make up the path Ruby searches external file</li>
<li><code>$0</code> contains the name of the startup file for the currently running program</li>
<li><code>$$</code> contains the process ID</li>
<li><code>require &quot;English&quot;</code> has the list of human readable names for global variables</li>
</ul>
</li>
</ul>
<h4 id="local">Local</h4>
<ul>
<li><em>local scope</em> is the basic layer of every Ruby program</li>
<li>the top level has its own local scope</li>
<li>every class or module-definition block has its own local scope, same for nested</li>
<li>every method definition has its own local scope</li>
<li>every call to a method generates a new local scope with all local variables reset to an undefined state</li>
</ul>
<h4 id="constants-1">Constants</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">module</span> M
  <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">D</span>
      <span style="color:#66d9ef">module</span> N
        X <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
      <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
    puts D<span style="color:#f92672">::</span>N<span style="color:#f92672">::</span>X <span style="color:#75715e"># 1</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#75715e">## refer to X</span>
M<span style="color:#f92672">::</span>C<span style="color:#f92672">::</span>D<span style="color:#f92672">::</span>N<span style="color:#f92672">::</span>X
</code></pre></div><ul>
<li>constants have a kind of global visibility, as long as you know the path to a constant through classes and/or modules</li>
<li>constant lookup is similar to searching a file in a directory</li>
<li>sometimes it&rsquo;s useful to state constant-lookup at top level to avoid confusion with built-in class or module, e.g. custom <code>Violin::String</code> vs native <code>::String</code></li>
<li>double colon at the beginning means start searching at top level</li>
</ul>
<h4 id="class-variables">Class variables</h4>
<ul>
<li>class variables begin with two at-signs, e.g. <code>@@var</code></li>
<li>class variables are visible to a class and its instances</li>
<li>class variables are class-hierarchy-scoped</li>
<li>since Ruby classes are instances of <code>Class</code>, instance variables also work on classes</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Camera</span>
  @@models <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
  @@cameras <span style="color:#f92672">=</span> {}
  @@total_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">attr_reader</span> <span style="color:#e6db74">:model</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">total_count</span>
    @total_count <span style="color:#f92672">||=</span> <span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">total_count</span><span style="color:#f92672">=</span>(n)
    @total_count <span style="color:#f92672">=</span> n
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">self</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add_model</span>(model)
    <span style="color:#66d9ef">unless</span> @@models<span style="color:#f92672">.</span>include?(model)
      @@models <span style="color:#f92672">&lt;&lt;</span> model
      @@cameras<span style="color:#f92672">[</span>model<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(model)
    <span style="color:#66d9ef">if</span> @@models<span style="color:#f92672">.</span>include?(model)
      puts <span style="color:#e6db74">&#34;Creating a new </span><span style="color:#e6db74">#{</span>model<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>
      @model <span style="color:#f92672">=</span> model
      @@cameras<span style="color:#f92672">[</span>model<span style="color:#f92672">]</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
      self<span style="color:#f92672">.</span>class<span style="color:#f92672">.</span>total_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">else</span>
      <span style="color:#66d9ef">raise</span> <span style="color:#e6db74">&#34;No such model: </span><span style="color:#e6db74">#{</span>model<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">model_count</span>
    @@cameras<span style="color:#f92672">[</span>self<span style="color:#f92672">.</span>model<span style="color:#f92672">]</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Leica</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Camera</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>add_model(<span style="color:#e6db74">&#34;M9&#34;</span>)
<span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>add_model(<span style="color:#e6db74">&#34;M10&#34;</span>)
<span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>add_model(<span style="color:#e6db74">&#34;X-Pro3&#34;</span>)
f1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;X-Pro3&#34;</span>)
l1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">Leica</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;M9&#34;</span>)
l2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">Leica</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;M10&#34;</span>)
puts <span style="color:#e6db74">&#34;There are </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>total_count<span style="color:#e6db74">}</span><span style="color:#e6db74"> Cameras!&#34;</span>
puts <span style="color:#e6db74">&#34;There are </span><span style="color:#e6db74">#{</span><span style="color:#66d9ef">Leica</span><span style="color:#f92672">.</span>total_count<span style="color:#e6db74">}</span><span style="color:#e6db74"> Leicas!&#34;</span>
<span style="color:#75715e"># Leica would have its own total count</span>
<span style="color:#75715e"># Output:</span>
<span style="color:#75715e"># Creating a new X-Pro3!</span>
<span style="color:#75715e"># Creating a new M9!</span>
<span style="color:#75715e"># Creating a new M10!</span>
<span style="color:#75715e"># There are 1 Cameras!</span>
<span style="color:#75715e"># There are 2 Leicas!</span>
</code></pre></div><h3 id="method-access-rules">Method-access rules</h3>
<ul>
<li>instance methods defined below <code>private</code> are private</li>
<li>use <code>public</code> or <code>protected</code> to reverse the effect</li>
<li><code>private</code> can also take as arguments a list of the methods:
<ul>
<li><code>private :method1, :method2</code></li>
</ul>
</li>
<li><code>private</code> method cannot be called with explicit receiver</li>
<li>private setter can be called with receiver <code>self</code>
<ul>
<li><code>def manufacture_year=(years)</code></li>
</ul>
</li>
<li><code>protected</code> methods can be called on object <code>x</code> as long as the default object (<code>self</code>) is an instance of the same class as <code>x</code> or an ancestor or descendant class of <code>x</code>'s class</li>
<li>subclasses inherit the method-access rules of their superclasses</li>
<li>top-level method is stored as a private instance method of <code>Object</code> class</li>
<li>top-level methods must be called in bareword style due to <code>private</code> forbidding explicit receiver</li>
<li>private instance methods of <code>Object</code> is available anywhere in the code because <code>Object</code> lies in the method-lookup path of every class</li>
<li>Ruby has a list of built-in private instance methods like <code>puts</code> and <code>print</code></li>
</ul>
<h2 id="control-flow">Control Flow</h2>
<ul>
<li>conditional: execution depends on the truth of an expression</li>
<li>loop: a single piece of code is executed repeatedly</li>
<li>iteration: a call to a method is supplemented with a segment of code that the method can call one or more times during its own execution</li>
<li>exception: error conditions</li>
</ul>
<h3 id="conditional">Conditional</h3>
<p>The <code>if</code>, <code>elsif</code> and <code>else</code> together evaluate to an object, the value is whatever is represented by the code in the successful branch, if the <code>if</code> statement doesn&rsquo;t succeed anywhere its value is <code>nil</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">if</span> condition
  <span style="color:#75715e"># code executed if condition is true</span>
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># in one line:</span>
<span style="color:#66d9ef">if</span> condition <span style="color:#66d9ef">then</span> code <span style="color:#66d9ef">end</span>

<span style="color:#75715e"># semicolons as line breaks</span>
<span style="color:#66d9ef">if</span> condition; code; <span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">if</span> condition
  <span style="color:#75715e"># code executed if condition is true</span>
<span style="color:#66d9ef">else</span>
  <span style="color:#75715e"># code executed if condition is false</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">if</span> condition1
  <span style="color:#75715e"># code</span>
<span style="color:#66d9ef">elsif</span> condition2
  <span style="color:#75715e"># code</span>
<span style="color:#66d9ef">else</span> condition3
  <span style="color:#75715e"># code</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Negate a codition using not, ! or <code>unless</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># negate a condition usually have parentheses</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> condition
<span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>condition

<span style="color:#75715e"># alternative way for negating a condition</span>
<span style="color:#66d9ef">unless</span> condition

<span style="color:#66d9ef">unless</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>
  puts <span style="color:#e6db74">&#34;Small number!&#34;</span>
<span style="color:#66d9ef">else</span>
  puts <span style="color:#e6db74">&#34;Big number!&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Conditional modifiers are usually used for simple condition, without <code>else</code> or <code>elsif</code> branching.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">puts <span style="color:#e6db74">&#34;Big numbers!&#34;</span> <span style="color:#66d9ef">if</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>
puts <span style="color:#e6db74">&#34;Pass!&#34;</span> <span style="color:#66d9ef">unless</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">50</span>
</code></pre></div><p>When Ruby parser sees sequence <em>identifier</em>, <em>equal-sign</em>, and <em>value</em>, it allocates space for local variable without assignment of a value:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">false</span>
  x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">end</span>
<span style="color:#75715e"># the value of x is nil since parser allocates space for x without a value</span>
</code></pre></div><p>Assignment in a conditional test evaluates to the value of the assignment, some times it&rsquo;s needed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">if</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">/ha/</span><span style="color:#f92672">.</span>match(name)
  puts <span style="color:#e6db74">&#34;Found a match!&#34;</span>
  puts m
<span style="color:#66d9ef">else</span>
  puts <span style="color:#e6db74">&#34;No match&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h4 id="case">case</h4>
<p>A <code>case</code> statement starts with an expression and goes through a list of possible matches, each possible match is contained in a <code>when</code> statement consisting of one or more possible matching objects and a segment of code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">answer <span style="color:#f92672">=</span> gets<span style="color:#f92672">.</span>chomp
<span style="color:#66d9ef">case</span> answer
<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;yes&#34;</span>
  puts <span style="color:#e6db74">&#34;Good-bye!&#34;</span>
  exit
<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;no&#34;</span>
  puts <span style="color:#e6db74">&#34;Good!&#34;</span>
<span style="color:#66d9ef">else</span>
  puts <span style="color:#e6db74">&#34;Unknown answer&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>It&rsquo;s possible to have more than one possible match in a single <code>when</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">case</span> answer
<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#e6db74">&#34;yes&#34;</span>
  puts <span style="color:#e6db74">&#34;Bye!&#34;</span>
  exit
</code></pre></div><p>It&rsquo;s also possible to start a <code>case</code> statement without test expression, this is an alternative way of <code>if</code> statement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">case</span>
<span style="color:#66d9ef">when</span> camera<span style="color:#f92672">.</span>model <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Leica&#34;</span>
  puts <span style="color:#e6db74">&#34;You got a Leica!&#34;</span>
<span style="color:#66d9ef">when</span> camera<span style="color:#f92672">.</span>manufactured_year <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2000</span>
  puts <span style="color:#e6db74">&#34;Your camera is old!&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>every Ruby object has a <code>case equality</code> method <code>===</code></li>
<li>three equal signs, <em>case subsumption</em>, <em>threequal operator</em></li>
<li>outcome of === determins whether a <code>when</code> has matched</li>
<li>each <code>case</code> statement evaluates to a single object</li>
<li>the value of entire <code>case</code> statement is the code in matching <code>when</code> clause</li>
<li>if no matching <code>when</code> clause the entire statement evaluates to <code>nil</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># equivalent</span>
<span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#34;yes&#34;</span>
<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;yes&#34;</span> <span style="color:#f92672">===</span> answer
<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;yes&#34;</span><span style="color:#f92672">.</span>==<span style="color:#f92672">=</span>(answer)

<span style="color:#75715e"># override ===</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Camera</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">===</span>(other_camera)
    self<span style="color:#f92672">.</span>model <span style="color:#f92672">==</span> other_camera<span style="color:#f92672">.</span>model
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="loops">Loops</h3>
<p>Ruby allows looping repeatedly through code with conditional logic:</p>
<ul>
<li><code>while</code> a given condition is true</li>
<li><code>until</code> a given condition is true</li>
<li><code>unconditionally</code> break out of a loop</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">loop</span> { code }
<span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
  code
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Terminates the loop:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
  n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">break</span> <span style="color:#66d9ef">if</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">9</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Skip to the next iteration without finishing current iteration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
  n <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">next</span> <span style="color:#66d9ef">unless</span> n <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>
  <span style="color:#66d9ef">break</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Conditional looping with <code>while</code> and <code>until</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">while</span> condition
  <span style="color:#75715e"># code executed when condition is true</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p><code>while</code> can also work with <code>begin</code> / <code>end</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">begin</span>
  <span style="color:#75715e"># code executed</span>
<span style="color:#66d9ef">end</span> <span style="color:#66d9ef">while</span> condition
</code></pre></div><p>Like <code>if</code> and <code>unless</code>, <code>while</code> has also a pair <code>until</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">until</span> condition
  <span style="color:#75715e"># code executed if condition is false</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">begin</span>
  <span style="color:#75715e"># code executed</span>
<span style="color:#66d9ef">end</span> <span style="color:#66d9ef">until</span> condition
</code></pre></div><p>There&rsquo;s also a shorter way to use <code>while</code> and <code>until</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">until</span> n <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>
n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>
</code></pre></div><p>Looping through a list of values using <code>for</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">scores <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">41</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">PASS</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
<span style="color:#66d9ef">for</span> score <span style="color:#66d9ef">in</span> scores
  <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&gt;=</span> <span style="color:#66d9ef">PASS</span>
    puts <span style="color:#e6db74">&#34;Pass!&#34;</span>
  <span style="color:#66d9ef">else</span>
    puts <span style="color:#e6db74">&#34;Fail!&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>loop is an <em>iterator</em> which is a Ruby method that expects a <em>code block</em></li>
</ul>
<h3 id="iterators-and-code-blocks">Iterators and code blocks</h3>
<ul>
<li>an iterator is a Ruby method that expects a <em>code block</em></li>
<li>inside an iterator the method can <em>call</em> the code block using <code>yield</code></li>
<li>a code block isn&rsquo;t an argument</li>
<li>every method has the following syntax:
<ul>
<li>a receiver object or variable (defaulting to <code>self</code>)</li>
<li>a dot</li>
<li>a method name</li>
<li>a list of arguments (optional, defaults to <code>()</code>)</li>
<li>a clode block (optional)</li>
</ul>
</li>
</ul>
<p><code>String#split</code> for example, splits its receiver on the delimiter argument and returns an array of splitted components, with a block, <code>split</code> also yields the split components to the block, one at a time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">array <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">]</span>
array<span style="color:#f92672">.</span>map { <span style="color:#f92672">|</span>n<span style="color:#f92672">|</span> n <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> }
array<span style="color:#f92672">.</span>map <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>n<span style="color:#f92672">|</span> n <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">end</span>
</code></pre></div><p>Implementing different types of loops using <code>yield</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_loop</span>
  <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">true</span>
    <span style="color:#66d9ef">yield</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_simpler_loop</span>
  <span style="color:#66d9ef">yield</span> <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">true</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Integer</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_times</span>
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">until</span> c <span style="color:#f92672">==</span> self
      <span style="color:#66d9ef">yield</span> c
      c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">end</span>
    self <span style="color:#75715e"># return the value itself</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

rtn <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">.</span>my_times { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> puts <span style="color:#e6db74">&#34;I&#39;m on iteration </span><span style="color:#e6db74">#{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> }
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Array</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_each</span>
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">until</span> c <span style="color:#f92672">==</span> size
      <span style="color:#66d9ef">yield</span> self<span style="color:#f92672">[</span>c<span style="color:#f92672">]</span>
      c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">end</span>
    self
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

array <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
array<span style="color:#f92672">.</span>my_each { <span style="color:#f92672">|</span>e<span style="color:#f92672">|</span> puts <span style="color:#e6db74">&#34;I got </span><span style="color:#e6db74">#{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> }
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Array</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_map</span>
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    acc <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
    <span style="color:#66d9ef">until</span> c <span style="color:#f92672">==</span> size
      acc <span style="color:#f92672">&lt;&lt;</span> <span style="color:#66d9ef">yield</span> self<span style="color:#f92672">[</span>c<span style="color:#f92672">]</span>
      c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">end</span>
    acc
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

names <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Tom&#34;</span>, <span style="color:#e6db74">&#34;Bill&#34;</span><span style="color:#f92672">]</span>
names<span style="color:#f92672">.</span>my_map { <span style="color:#f92672">|</span>name<span style="color:#f92672">|</span> name<span style="color:#f92672">.</span>upcase }
</code></pre></div><p>A simpler <code>my_map</code> using <code>my_each</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Array</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_map</span>
    acc <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
    my_each { <span style="color:#f92672">|</span>e<span style="color:#f92672">|</span> acc <span style="color:#f92672">&lt;&lt;</span> <span style="color:#66d9ef">yield</span> e }
    acc
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="block-parameters-and-variable-scopes">Block parameters and variable scopes</h3>
<ul>
<li>blocks have direct access to variables that already exist</li>
<li>block parameters are different from non-parameter variables even if they have the same name</li>
<li>to preserve existing variables, define a block-local variable
<ul>
<li><code>array.each do |e;local|</code></li>
<li>semicolon followed by a variable name indicates the variable is block-local</li>
<li>changing such variable won&rsquo;t affect existing one that has the same name</li>
<li>block-variables are not considered block parameters and don&rsquo;t get bound to anything when the block is called</li>
<li>they are <em>reserved names</em></li>
</ul>
</li>
</ul>
<h3 id="error-handling-and-exceptions">Error handling and exceptions</h3>
<p>Common exceptions:</p>
<ul>
<li>runtime error: raised by <code>raise</code></li>
<li>NoMethodError: sending a message to an object which cannot resolve the message to a method name, raised by default <code>method_missing</code></li>
<li>NameError: an identifier cannot be resolved as a variable or method name by interpreter</li>
<li>IOError: reading a closed stream, writing to a readonly stream and similar operations</li>
<li>Errno::error: errors relates to file I/O</li>
<li>TypeError: a method receives an argument it cannot handle</li>
<li>Argument-Error: using wrong number of arguments</li>
</ul>
<p>Use <code>rescue</code> to catch and handle exception:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">n <span style="color:#f92672">=</span> gets<span style="color:#f92672">.</span>to_i
<span style="color:#66d9ef">begin</span>
  result <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">/</span> n
<span style="color:#66d9ef">rescue</span>
  puts <span style="color:#e6db74">&#34;Invalid number for division 100/</span><span style="color:#e6db74">#{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
  exit
<span style="color:#66d9ef">end</span>
puts <span style="color:#e6db74">&#34;100/</span><span style="color:#e6db74">#{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74"> is </span><span style="color:#e6db74">#{</span>result<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</code></pre></div><p>It&rsquo;s a good practice to specify what exceptions you want to handle, to catch specific exception:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">rescue</span> <span style="color:#66d9ef">ZeroDivisionError</span>
</code></pre></div><p>The beginning of a method or code block provides an implicit <code>begin</code>/<code>end</code> context, as a result, using <code>rescue</code> inside a method or code block won&rsquo;t need <code>begin</code>:</p>
<ul>
<li><code>rescue</code> applies to any failing statement preceding it within the block</li>
<li>to get more fine grained control for <code>rescue</code>, explicit <code>begin</code>/<code>end</code> wrapper is still needed</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_camera_profile</span>
  filename <span style="color:#f92672">=</span> gets<span style="color:#f92672">.</span>chomp
  file <span style="color:#f92672">=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(filename)
  <span style="color:#66d9ef">yield</span> file
  file<span style="color:#f92672">.</span>close
  <span style="color:#66d9ef">rescue</span>
    puts <span style="color:#e6db74">&#34;Cannot open camera profile </span><span style="color:#e6db74">#{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li>it&rsquo;s necessary to have a <code>return</code> inside rescue otherwise the method continues to execute</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_camera_profile</span>
  filename <span style="color:#f92672">=</span> gets<span style="color:#f92672">.</span>chomp
  <span style="color:#66d9ef">begin</span>
    file <span style="color:#f92672">=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(filename)
  <span style="color:#66d9ef">rescue</span>
    puts <span style="color:#e6db74">&#34;Cannot open camera profile </span><span style="color:#e6db74">#{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">!&#34;</span>
    <span style="color:#66d9ef">return</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">yield</span> file
  file<span style="color:#f92672">.</span>close
<span style="color:#66d9ef">end</span>
</code></pre></div><p>For <code>NoMethodError</code> when calling a method on <code>nil</code>, save navigation is allowed using <code>&amp;.</code> instead of <code>.</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">if</span> collection<span style="color:#f92672">.</span>cameras<span style="color:#f92672">&amp;.</span>first<span style="color:#f92672">&amp;.</span>model <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Leica&#34;</span>
  puts <span style="color:#e6db74">&#34;Your first camera is a Leica!&#34;</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h4 id="bindingirb">binding.irb</h4>
<ul>
<li>Ruby provides a way to debug by opening an <code>irb</code> session from anywhere using <code>binding.irb</code></li>
<li>put <code>binding.irb</code> would cause execution pause at that line with an <code>irb</code> session</li>
<li>the <code>irb</code> session has the context of any code executed to this point for inspection</li>
</ul>
<h4 id="raising-exceptions">Raising exceptions</h4>
<ul>
<li>exceptions can be raised by <code>raise exception, message</code>, e.g. <code>raise ArgumentError, &quot;invalid input&quot;</code></li>
<li>without exception after <code>raise</code>, <code>RuntimeError</code> is default</li>
<li>to assign the exception object to a variable, use <code>=&gt;</code> along with <code>rescue</code>
<ul>
<li>the object has useful information about the exception, such like <code>backtrace</code> and <code>message</code></li>
<li>e.g. <code>rescue ArgumentError =&gt; e</code></li>
</ul>
</li>
<li>exception raising is classed based, <code>raise ZeroDivisionError</code> instead of <code>raise ZeroDivisionError.new</code></li>
<li>use <code>ensure</code> to execute code before the method finishes</li>
<li>custom exception can be created by subclassing <code>Exception</code> class (or its subclasses)
<ul>
<li>e.g. <code>class MyException &lt; Exception; end</code></li>
</ul>
</li>
</ul>
<p>Re-raise catched exception:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">begin</span>
  file <span style="color:#f92672">=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(filename)
<span style="color:#66d9ef">rescue</span> <span style="color:#f92672">=&gt;</span> e
  puts <span style="color:#e6db74">&#34;Cannot open file </span><span style="color:#e6db74">#{</span>filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
  <span style="color:#75715e"># Ruby is smart enough to figure out it&#39;s the same exception to raise</span>
  <span style="color:#66d9ef">raise</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">line_from_file</span>(filename, substring)
  file <span style="color:#f92672">=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(filename)
  <span style="color:#66d9ef">begin</span>
    line <span style="color:#f92672">=</span> file<span style="color:#f92672">.</span>gets
    <span style="color:#66d9ef">raise</span> <span style="color:#66d9ef">ArgumentError</span> <span style="color:#66d9ef">unless</span> line<span style="color:#f92672">.</span>include?(substring)
  <span style="color:#66d9ef">rescue</span> <span style="color:#66d9ef">ArgumentError</span>
    puts <span style="color:#e6db74">&#34;Invalid line!&#34;</span>
    <span style="color:#66d9ef">raise</span>
  <span style="color:#66d9ef">ensure</span>
    file<span style="color:#f92672">.</span>close
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">return</span> line
<span style="color:#66d9ef">end</span>
</code></pre></div><h2 id="built-in-basics">Built-in basics</h2>
<h3 id="literal-constructors">Literal constructors</h3>
<table>
<thead>
<tr>
<th>Class</th>
<th>Literal constructor</th>
<th>e.g.</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>String</code></td>
<td>Quotation marks</td>
<td>&ldquo;new string&rdquo;, <code>new string</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Leading colon</td>
<td><code>:symbol</code>, <code>:&quot;symbol with spaces&quot;</code></td>
</tr>
<tr>
<td>Array</td>
<td>Square brackets</td>
<td>[1, 2, 3, 4, 5]</td>
</tr>
<tr>
<td>Hash</td>
<td>Curly braces</td>
<td>{&ldquo;Name&rdquo;: &ldquo;Tom&rdquo;}</td>
</tr>
<tr>
<td>Range</td>
<td>Two or three dots</td>
<td>0..9, 0&hellip;12</td>
</tr>
<tr>
<td>Regexp</td>
<td>Forward slashes</td>
<td>/([a-z]+)/</td>
</tr>
<tr>
<td>Proc lambda</td>
<td>Dash, arrow, parentheses, braces</td>
<td><code>-&gt;(x, y) { x*y}</code></td>
</tr>
</tbody>
</table>
<h3 id="syntactic-sugar">Syntactic sugar</h3>
<ul>
<li>Ruby provides syntax sugar for certain operations like method-calling</li>
<li>the operators can be overridden</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meter</span>
  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:exposure</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(start_exposure<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
    self<span style="color:#f92672">.</span>exposure <span style="color:#f92672">=</span> start_exposure
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">+</span>(e)
    self<span style="color:#f92672">.</span>exposure <span style="color:#f92672">+=</span> e
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">-</span>(x)
    self<span style="color:#f92672">.</span>exposure <span style="color:#f92672">-=</span> e
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_s</span>
    exposure<span style="color:#f92672">.</span>to_s
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

meter <span style="color:#f92672">=</span> <span style="color:#66d9ef">Meter</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">1</span>)
meter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
meter <span style="color:#f92672">-=</span> <span style="color:#ae81ff">2</span>
</code></pre></div><h3 id="overriding-unary-operators">Overriding unary operators</h3>
<ul>
<li>unary operators <code>+</code> and <code>-</code> can be overridden by defining the method <code>+@</code> and <code>-@</code></li>
<li>logical not (!) operator can also be defined</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Saturation</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(s<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
    @sat <span style="color:#f92672">=</span> s
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_s</span>
    @sat<span style="color:#f92672">.</span>to_s
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">+@</span>
    @sat <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">-@</span>
    @sat <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#f92672">!</span>
    <span style="color:#f92672">-</span>@sat
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

saturation <span style="color:#f92672">=</span> <span style="color:#66d9ef">Saturation</span><span style="color:#f92672">.</span>new
puts <span style="color:#f92672">+</span>saturation
puts <span style="color:#f92672">!</span>saturation
puts (<span style="color:#f92672">not</span> saturation) <span style="color:#75715e"># not saturation</span>
</code></pre></div><h3 id="bang--methods">Bang (!) methods</h3>
<ul>
<li>Ruby methods canend with an exclamation point (!)</li>
<li>there&rsquo;s no significance to Ruby internall</li>
<li>only conventional for marking a method &ldquo;dangerous&rdquo;</li>
<li>e.g. <em>permanently</em> modifies receiver, <em>mutates</em> the state of caller</li>
<li>advice: only use ! when there&rsquo;s a method of the same name without !</li>
</ul>
<h3 id="built-in-and-custom-to_-methods">Built-in and custom <code>to_*</code> methods</h3>
<p>Ruby offers a number of built-in methods whose name consist of <code>to_</code> plus an indicator of a class to which method method converts an object.</p>
<ul>
<li>
<p><code>to_s</code> to string</p>
</li>
<li>
<p><code>to_sym</code> to symbol</p>
</li>
<li>
<p><code>to_a</code> to array</p>
</li>
<li>
<p><code>to_i</code> to integer</p>
</li>
<li>
<p><code>to_f</code> to float</p>
</li>
<li>
<p><code>puts</code> calls <code>to_s</code> on its arguments</p>
</li>
<li>
<p><code>puts</code> on array gives a representation based on calling <code>to_s</code> on each of the elements</p>
</li>
<li>
<p><code>to_s</code> called on array returns only a single string representation</p>
</li>
<li>
<p>every object except <code>BasicObject</code> has method <code>inspect</code> which prints memory dump of calling object</p>
</li>
<li>
<p><code>display</code> takes an argument of a writable output stream, default is <code>STDOUT</code></p>
</li>
</ul>
<h3 id="array-conversion">Array conversion</h3>
<ul>
<li><code>to_a</code> provides an array-like representation of objects</li>
<li><code>to_a</code> is defined on <code>Array</code>, not on <code>Object</code></li>
<li><em>bare list</em> means several identifiers or literal objects separated by commas
<ul>
<li><code>[1, 2, 3, 4, 5]</code> is an array of the bare list <code>1, 2, 3, 4, 5</code></li>
</ul>
</li>
<li><em>bare list</em> can be used for method arguments
<ul>
<li><code>def method(arg1, arg2)</code></li>
<li><code>arguments = [1, 2]; method(*arguments)</code></li>
</ul>
</li>
<li>objects can be used as arrays if implementing <code>to_ary</code></li>
<li><code>to_ary</code> is called where array and only array will work. e.g. array concatenation</li>
</ul>
<h3 id="number-conversion">Number conversion</h3>
<ul>
<li><code>to_i</code> converts the object to an integer</li>
<li>strings that have no reasonable integer equivalent (e.g. &ldquo;Hello&rdquo;) converts to 0</li>
<li>strings that start with digits but also include non-digits, the non-digits part is ignored for <code>to_i</code></li>
<li><code>to_f</code> converts the objects to floating-point</li>
<li>methods <code>Integer</code> and <code>Float</code> exist but are stricter than <code>to_i</code> and <code>to_f</code></li>
<li>objects that respond to <code>to_str</code> will have <code>to_str</code> representation used as the argument to <code>String#+</code></li>
<li><code>to_str</code> is also used on arguments to the <code>&lt;&lt;</code> (append to string) method</li>
</ul>
<h3 id="boolean">Boolean</h3>
<ul>
<li>every expression in Ruby evaluates to an object</li>
<li>every object has a Boolean value of either <code>true</code> or <code>false</code></li>
<li><code>true</code> and <code>false</code> are both objects</li>
</ul>
<p>Some expressions&rsquo; values:</p>
<ul>
<li><code>class MyClass; end</code> evaluates to <code>nil</code></li>
<li><code>class MyClass; 1; end</code> evaluates to <code>1</code></li>
<li><code>def m; return false; end</code> evaluates to <code>:m</code></li>
<li><code>&quot;Hello, world!&quot;</code> evaluates to <code>&quot;Hello, world!&quot;</code></li>
<li><code>100 &gt; 50</code> evaluates to <code>true</code></li>
<li>the only objects that have a Boolean value of false are <code>false</code> and <code>nil</code></li>
</ul>
<h3 id="the-special-object-nil">The special object nil</h3>
<ul>
<li><code>nil</code> is the only instance of the class <code>NilClass</code></li>
<li>the Boolean value of <code>nil</code> is false</li>
<li><code>nil</code> denotes an absence of anything
<ul>
<li><code>[&quot;one&quot;, &quot;two&quot;][3]</code> evaluates to <code>nil</code></li>
</ul>
</li>
<li><code>nil.to_s</code> is empty string</li>
<li>the integer representation of <code>nil</code> is 0</li>
<li><code>nil</code>'s object ID is 8</li>
</ul>
<h3 id="objects-comparison">Objects comparison</h3>
<ul>
<li>Ruby&rsquo;s built-in module <code>Comparable</code> provides ways to compare objects</li>
<li>equality tests: <code>Object</code> class defines <code>==</code>, <code>eql?</code> and <code>equal?</code></li>
<li>redefine <code>==</code> for comparison
<ul>
<li><code>String</code> compares if the value of strings are identical</li>
<li><code>Numeric</code> (a super class of <code>Integer</code> and <code>Float</code>) redefines <code>==</code> for comparing number values with type conversion</li>
<li><code>Numeric</code>'s <code>eql?</code> doesn&rsquo;t do type conversion</li>
</ul>
</li>
</ul>
<p>To make an object <code>Comparable</code>:</p>
<ul>
<li>mix-in the module <code>Comparable</code></li>
<li>define a comparison method with the name <code>&lt;=&gt;</code> as an instance method of the object</li>
<li><code>&lt;=&gt;</code> is usually called the <em>spaceship operator</em> or <em>spaceship method</em></li>
<li>inside the method you define what is <em>less than</em>, <em>equal to</em> and <em>greater than</em></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Camera</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Comparable</span>
  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:rating</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">&lt;=&gt;</span>(other_camera)
    <span style="color:#75715e"># the following can also be simplified as:</span>
    <span style="color:#75715e"># self.rating &lt;=&gt; other_camera.rating</span>
    <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>rating <span style="color:#f92672">&lt;</span> other_camera<span style="color:#f92672">.</span>rating
      <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elsif</span> self<span style="color:#f92672">.</span>rating <span style="color:#f92672">&gt;</span> other_camera<span style="color:#f92672">.</span>rating
      <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">else</span>
      <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 id="inspecting-objects">Inspecting objects</h3>
<ul>
<li><code>methods</code> shows what the object, class or module responds to</li>
<li><code>instance_methods</code> on class shows all the instance methods that the instances of the class has</li>
<li><code>instance_methods(false)</code> shows without the methods from ancestors</li>
</ul>
<h2 id="strings-symbols-and-other-scalar-objects">Strings, symbols and other scalar objects</h2>
<ul>
<li>string interpolation doesn&rsquo;t work with single-quoted strings
<ul>
<li><code>&quot;One plus one is #{1 + 1}&quot;</code>: &ldquo;One plus one is 2&rdquo;</li>
<li><code>'One plus one is #{1 + 1}'</code>: &ldquo;One plus one is #{1 + 1}&rdquo;</li>
</ul>
</li>
<li>escape interpolation mechanism in double-quoted string using backslashes
<ul>
<li><code>&quot;One plus one is \&quot;\#{1 + 1}\&quot;.&quot;</code></li>
</ul>
</li>
<li>alternative quoting mechanisms take the form <code>%char{text}</code>
<ul>
<li><code>%q{this is a single quoted string}</code></li>
<li><code>%Q{this is a double quoted string}</code></li>
<li>curly braces are most commonly used but it can be anything</li>
<li>opening delimiter has to match closing one</li>
<li><code>%q-a string-</code></li>
<li><code>%Q/Another string/</code></li>
</ul>
</li>
<li>including unmatched brace of the same type must be escaped
<ul>
<li><code>%Q{this () is fine. }</code></li>
<li><code>q(This \( has to be escaped.)</code></li>
</ul>
</li>
<li><em>heredoc</em> is a string, usually a multiline string defined through <code>&lt;&lt;</code> operator
<ul>
<li><code>&lt;&lt;EOM</code> means the text that follows, up to but not including the next occurrence of &ldquo;EOM&rdquo;</li>
<li><code>SQL</code> is also common for SQL query</li>
<li>delimiter must be flush left and be the only thing on the line where it occurs</li>
<li>swiching off the flush-left requirement by putting a hyphen before <code>&lt;&lt;</code> operator</li>
<li>squiggly heredoc <code>&lt;&lt;~</code> strips leading whitespace from output</li>
<li>by default heredocs are read in as double-quoted strings, thus can include string interpolation</li>
<li>to have single-quoted heredoc, enclose the marker with single quote</li>
<li><code>&lt;&lt;EOM</code> or any open delimiter doesn&rsquo;t have to be the last thing on its line
<ul>
<li>it&rsquo;s just a placeholder for upcoming heredoc</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">text <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#66d9ef">EOM</span>
<span style="color:#66d9ef">First</span> line
<span style="color:#66d9ef">Second</span> line
<span style="color:#66d9ef">EOM</span>

another_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;-EOM
</span><span style="color:#e6db74"></span><span style="color:#66d9ef">The</span> <span style="color:#66d9ef">EOM</span> doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t have to be flush left!
  <span style="color:#66d9ef">EOM</span>

single_quoted <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;-`EOM`
</span><span style="color:#e6db74"></span>this is a
single quoted line
<span style="color:#66d9ef">EOM</span>

a <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;&lt;EOM.to_i * 10
</span><span style="color:#e6db74"></span><span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">EOM</span>
puts a <span style="color:#75715e"># output is 50</span>
</code></pre></div><h3 id="basic-string-manipulation">Basic string manipulation</h3>
<p>Use <code>[]</code> operator/method to retrieve the nth character in a string, negative numbers index from the end of the string:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;Ruby is cool&#34;</span><span style="color:#f92672">[</span><span style="color:#ae81ff">5</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;i&#34;</span>
<span style="color:#e6db74">&#34;Ruby is cool&#34;</span><span style="color:#f92672">[-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;l&#34;</span>
</code></pre></div><p>A second integer argument <code>m</code> gets a substring of <code>m</code> characters:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;Ruby is cool&#34;</span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;ub&#34;</span>
</code></pre></div><p>A single <em>range</em> object can be provided as argument, two dots are inclusive, three dots means exclusive, the second index must always be closer to the end of the string than the first index:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#39;Ruby is cool&#39;</span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">3</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;uby&#34;</span>
<span style="color:#e6db74">&#39;Ruby is cool&#39;</span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">...</span><span style="color:#ae81ff">3</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;ub&#34;</span>
</code></pre></div><p>Get substring return <code>nil</code> if substring isn&rsquo;t found, regular expressions can be used as well for matching.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;ruby is cool&#34;</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;is cool&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;is cool&#34;</span>
<span style="color:#e6db74">&#34;ruby is cool&#34;</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#34;something&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e"># nil</span>
</code></pre></div><p><code>slice</code> removes the characters from the string; <code>slice!</code> removes permanently</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ruby is cool&#34;</span>
string<span style="color:#f92672">.</span>slice!(<span style="color:#e6db74">&#34;is &#34;</span>)
string <span style="color:#75715e"># &#34;ruby cool&#34;</span>
</code></pre></div><p>Use <code>[]=</code> to set part of a string to a new value, integers, ranges, strings and regular expressions all work, if the part isn&rsquo;t found, or nothing matches, <code>IndexError</code> is raised:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;A quick brown fox jumps over a lazy dog.&#34;</span>
string<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;quick&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;slow&#34;</span>
string<span style="color:#f92672">[-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;!&#34;</span>
string <span style="color:#75715e"># &#34;A slow brown fox jumps over a lazy dog!&#34;</span>
</code></pre></div><p>Use <code>+</code> for string concatenation, use <code>&lt;&lt;</code> to append second string permanently to an existing string, use <code>#{}</code> for string interpolation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;Hi&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;there&#34;</span> <span style="color:#75715e"># &#34;Hi there&#34;</span>
string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hi &#34;</span>
string <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;there&#34;</span> <span style="color:#75715e"># &#34;Hi there&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>string<span style="color:#e6db74">}</span><span style="color:#e6db74">there.&#34;</span> <span style="color:#75715e"># &#34;Hi there&#34;</span>
</code></pre></div><h3 id="querying-strings">Querying strings</h3>
<ul>
<li>use <code>include?</code> to check if a string includes a substring</li>
<li>use <code>start_with?</code>, <code>end_with?</code> to check if string has prefix, suffix
<ul>
<li><code>start_with?</code> also supports regular expression</li>
</ul>
</li>
<li>use <code>empty?</code> to test if a string is empty</li>
<li>use <code>size</code> and <code>length</code> to get the size or length of the string</li>
<li>use <code>count</code> to check how many time a given string or letter occurs</li>
<li>use hyphen-separated range to count how many of a range of letters there are in the string</li>
<li><code>count</code> with a string checks the number of characters in the string that are in the character set</li>
<li>to negate the search put a <code>^</code> (caret) at the beginning of specification</li>
<li><code>count</code> can have multiple arguments</li>
<li>use <code>index</code> and <code>rindex</code> to get index of substring</li>
<li><code>ord</code> returns the ordinal code of a character
<ul>
<li><code>ord</code> sent to a string returns ordinal code of the first character</li>
</ul>
</li>
<li><code>chr</code> returns the character represented by the integer
<ul>
<li>sending <code>chr</code> to a number that doesn&rsquo;t represent a character causes a fatal error</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;A quick brown fox jumps over a lazy dog.&#34;</span>
string<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#34;quick&#34;</span>) <span style="color:#75715e"># true</span>
string<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#34;slow&#34;</span>) <span style="color:#75715e"># false</span>
string<span style="color:#f92672">.</span>start_with?(<span style="color:#e6db74">&#34;A&#34;</span>) <span style="color:#75715e"># true</span>
string<span style="color:#f92672">.</span>end_with?(<span style="color:#e6db74">&#34;B&#34;</span>) <span style="color:#75715e"># false</span>
string<span style="color:#f92672">.</span>start_with?(<span style="color:#e6db74">/[A-Z]/</span>) <span style="color:#75715e"># true</span>
string<span style="color:#f92672">.</span>empty? <span style="color:#75715e"># false</span>
<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>empty? <span style="color:#75715e"># true</span>
string<span style="color:#f92672">.</span>size <span style="color:#75715e"># 40</span>
string<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#75715e"># 2</span>
string<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;g-m&#34;</span>) <span style="color:#75715e"># 6</span>
string<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;aey. &#34;</span>) <span style="color:#75715e"># 13</span>
string<span style="color:#f92672">.</span>count(<span style="color:#e6db74">&#34;^a-z&#34;</span>) <span style="color:#75715e"># 9 for 8 spaces and one fullstop</span>
string<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#34;o&#34;</span>) <span style="color:#75715e"># 10</span>
string<span style="color:#f92672">.</span>rindex(<span style="color:#e6db74">&#34;o&#34;</span>) <span style="color:#75715e"># 37</span>
string<span style="color:#f92672">.</span>ord <span style="color:#75715e"># 97</span>
<span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">.</span>ord <span style="color:#75715e"># 97</span>
<span style="color:#ae81ff">97</span><span style="color:#f92672">.</span>chr <span style="color:#75715e"># a</span>
</code></pre></div><h3 id="string-comparison-and-transformation">String comparison and transformation</h3>
<ul>
<li>the <code>String</code> class mixes in <code>Comparable</code> and defines <code>&lt;=&gt;</code></li>
<li><code>==</code> is used to test sring content equality</li>
<li><code>String#equal?</code> checks whether two strings are the same object</li>
<li><code>upcase</code>, <code>downcase</code>, <code>swapcase</code>, <code>capitalize</code> and <code>capitalize!</code></li>
<li><code>rjust</code> and <code>ljust</code> expand the size of string with space padding
<ul>
<li>second argument provides padding string</li>
<li>padding pattern is repeated as many times as it will fit, truncating if necessary</li>
</ul>
</li>
<li><code>center</code> puts the characters of the string in the center
<ul>
<li>Odd-numbered padding are right-heavy</li>
</ul>
</li>
<li>use <code>strip</code>, <code>lstrip</code> and <code>rstrip</code> to strip whitespace from either or both sides</li>
<li><code>chop</code> removes a character unconditionally from end of string</li>
<li><code>chomp</code> removes a target substring if the string has that suffix</li>
<li>both <code>chop</code> and <code>chomp</code> have bang equivalents that change the string in place</li>
<li><code>clear</code> empties the string</li>
<li><code>replace</code> replaces string content with specified string in place</li>
<li><code>delete</code> removes part of the string</li>
<li><code>crypt</code> performs aDES encryption on the string</li>
<li><code>succ</code> gets the next-highest string, <code>&quot;z&quot;.succ</code> is <code>aa</code>, <code>&quot;bzz&quot;.succ</code> is <code>caa</code></li>
<li><code>to_i</code> converts a string to an integer
<ul>
<li>optional argument specifies the base</li>
<li><code>&quot;100&quot;.to_i(17)</code> is <code>289</code> (base 17 number)</li>
</ul>
</li>
<li><code>oct</code> converts the string to base 8 number</li>
<li><code>hex</code> converts the string to base 16 number, <code>&quot;A&quot;.hex</code> is 10</li>
</ul>
<h3 id="symbols">Symbols</h3>
<p><em>Symbols</em> are instances of the built-in class <code>Symbol</code>, the literal constructor is the leading colon.</p>
<ul>
<li>create a symbol programatically by calling <code>to_sym</code> or <code>intern</code></li>
<li>symbol can be converted to a string using <code>to_s</code></li>
<li>symbols are immutable</li>
<li>symbols are unique, the same symbol is always the same object</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">.</span>to_sym <span style="color:#75715e"># :a</span>
<span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">.</span>intern <span style="color:#75715e"># :&#34;hello&#34;</span>
<span style="color:#e6db74">:a</span><span style="color:#f92672">.</span>to_s <span style="color:#75715e"># &#34;a&#34;</span>
<span style="color:#e6db74">:xyz</span><span style="color:#f92672">.</span>object_id <span style="color:#75715e"># same as below</span>
<span style="color:#e6db74">:xyz</span><span style="color:#f92672">.</span>object_id <span style="color:#75715e"># same as above</span>
<span style="color:#66d9ef">Symbol</span><span style="color:#f92672">.</span>all_symbols <span style="color:#75715e"># return all the symbols</span>

<span style="color:#75715e"># use grep instead of include?</span>
<span style="color:#75715e"># include? would first put the symbol to the table</span>
<span style="color:#75715e"># which makes the result be always true</span>
<span style="color:#66d9ef">Symbol</span><span style="color:#f92672">.</span>all_symbols<span style="color:#f92672">.</span>grep(<span style="color:#e6db74">/abc/</span>)
</code></pre></div><p>Most common uses of symbols are method arguments and hash keys.</p>
<ul>
<li>Ruby processes symbols faster</li>
<li>symbols look good as hash keys</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">atr_accessor <span style="color:#e6db74">:name</span>

<span style="color:#75715e"># the &#34;send&#34; method also takes symbol as argument</span>
<span style="color:#e6db74">&#34;abc&#34;</span><span style="color:#f92672">.</span>send(<span style="color:#e6db74">:upcase</span>)

<span style="color:#75715e"># this also works</span>
some_object<span style="color:#f92672">.</span>send(method_name<span style="color:#f92672">.</span>to_sym)

person <span style="color:#f92672">=</span> { <span style="color:#e6db74">:name</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Tom&#34;</span>, <span style="color:#e6db74">:age</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">18</span> }
person<span style="color:#f92672">[</span><span style="color:#e6db74">:name</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;Tom&#34;</span>

<span style="color:#75715e"># simplified hash keys:</span>
person <span style="color:#f92672">=</span> { name: <span style="color:#e6db74">&#34;Tom&#34;</span>, <span style="color:#e6db74">age</span>: <span style="color:#ae81ff">36</span> }
</code></pre></div><h3 id="numericals">Numericals</h3>
<ul>
<li>In Ruby, numbers are objects.</li>
<li><code>Numeric</code> is the class from which <code>Float</code> and <code>Integer</code> inherit</li>
<li><code>Numeric</code> includes useful modules such as <code>Comparable</code></li>
</ul>
<h3 id="times-and-dates">Times and dates</h3>
<p>Three classes exist for times and dates: <code>Time</code>, <code>Date</code> and <code>DateTime</code>.</p>
<ul>
<li><code>require 'date'</code> for <code>Date</code> and <code>DateTime</code></li>
<li><code>require 'time'</code> for <code>Time</code></li>
</ul>
<h4 id="creating-date-objects">Creating date objects</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>today

<span style="color:#75715e"># send year, month and day</span>
<span style="color:#75715e"># without parameter, month and day default to 1, year defaults to -4712</span>
<span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">14</span>)

<span style="color:#75715e"># parse a date string</span>
<span style="color:#75715e"># assumes order of year/month/day</span>
<span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#34;2020/8/14&#34;</span>)
</code></pre></div><ul>
<li>Ruby by default expands the century if providing only a one- or two-digit number</li>
<li>for number equals to or greater than 69, the offset added is 1900
<ul>
<li><code>Date.parse(&quot;77/8/14&quot;)</code> is 1977-08-14</li>
</ul>
</li>
<li>for number between 0 and 68 the offset is 2000
<ul>
<li><code>Date.parse(&quot;03/8/14&quot;)</code> is 2003-08-14</li>
</ul>
</li>
<li><code>Date.parse</code> tries to understand different formats
<ul>
<li><code>&quot;November 2 2013&quot;</code></li>
<li><code>&quot;Aug 14 2020&quot;</code></li>
<li><code>&quot;14 Aug 2020&quot;</code></li>
</ul>
</li>
<li>create Monday-based day-of-week counting <code>Date</code> object using <code>jd</code> and <code>commercial</code> methods</li>
<li>scan a string against a format spec and generate a <code>Date</code> object using <code>strptime</code></li>
</ul>
<h4 id="creating-time-objects">Creating time objects</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>new <span style="color:#75715e"># a.k.a now</span>
<span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>at(<span style="color:#ae81ff">100000000</span>) <span style="color:#75715e"># number of seconds since the epoch (midnight on 1st Jan, 1970, GMT)</span>
<span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>mktime(<span style="color:#ae81ff">2020</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">14</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">31</span>,<span style="color:#ae81ff">3</span>) <span style="color:#75715e"># year, month, day, hour, minute and seconds, with reasonable defaults</span>
require <span style="color:#e6db74">&#39;time&#39;</span>
<span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#34;August 14, 2020, 6:32 am&#34;</span>)
</code></pre></div><h4 id="creating-datetime-objects">Creating date/time objects</h4>
<ul>
<li><code>DateTime</code> is a subclass of <code>Date</code></li>
<li>most common constructors are <code>new</code>, <code>now</code> and <code>parse</code></li>
<li>also features the specialized <code>jd</code> (Julian date), <code>commercial</code> and <code>strptime</code> constructors</li>
</ul>
<h4 id="datetime-query-methods">Date/time query methods</h4>
<p>The time and date objects have methods that represents themselves.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">dt <span style="color:#f92672">=</span> <span style="color:#66d9ef">DateTime</span><span style="color:#f92672">.</span>now
dt<span style="color:#f92672">.</span>year
dt<span style="color:#f92672">.</span>hour
dt<span style="color:#f92672">.</span>minute
dt<span style="color:#f92672">.</span>second <span style="color:#75715e"># DateTime objects have second and sec</span>
t <span style="color:#f92672">=</span> <span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>now
t<span style="color:#f92672">.</span>month
t<span style="color:#f92672">.</span>sec <span style="color:#75715e"># Time objects have only sec</span>
d <span style="color:#f92672">=</span> <span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>today
d<span style="color:#f92672">.</span>day

t<span style="color:#f92672">.</span>sunday?
d<span style="color:#f92672">.</span>saturday?
dt<span style="color:#f92672">.</span>friday?

d<span style="color:#f92672">.</span>leap?
dt<span style="color:#f92672">.</span>leap?
t<span style="color:#f92672">.</span>dst? <span style="color:#75715e"># daylight saving time available to Time only</span>
</code></pre></div><h4 id="datetime-formatting-methods">Date/time formatting methods</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">t <span style="color:#f92672">=</span> <span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>now <span style="color:#75715e"># 2020-08-14 06:49:19 +1000</span>
t<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%m-%d-%y&#34;</span>) <span style="color:#75715e"># &#34;08-14-20&#34;</span>
<span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>today<span style="color:#f92672">.</span>rfc2822
<span style="color:#66d9ef">DateTime</span><span style="color:#f92672">.</span>now<span style="color:#f92672">.</span>httpdate
</code></pre></div><table>
<thead>
<tr>
<th>Specifier</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>%Y</td>
<td>Year (four digits)</td>
</tr>
<tr>
<td>%y</td>
<td>Year (last two digits)</td>
</tr>
<tr>
<td>%b, %B</td>
<td>Short month, full month</td>
</tr>
<tr>
<td>%m</td>
<td>Day of month (left-padded with zeros)</td>
</tr>
<tr>
<td>%e</td>
<td>Day of month (left-padded with blanks)</td>
</tr>
<tr>
<td>%a, %A</td>
<td>Short day name, full day name</td>
</tr>
<tr>
<td>%H, %I</td>
<td>Hour (24-hour clock), hour (12-hour clock)</td>
</tr>
<tr>
<td>%M</td>
<td>Minute</td>
</tr>
<tr>
<td>%S</td>
<td>Second</td>
</tr>
<tr>
<td>%c</td>
<td>&ldquo;%a %b %d %H:%M:%S %Y&rdquo;</td>
</tr>
<tr>
<td>%x</td>
<td>&ldquo;%m/%d/%y&rdquo;</td>
</tr>
</tbody>
</table>
<ul>
<li>the <code>%c</code> and <code>%x</code> specifier may differ from one locale to another</li>
<li>all of the date/time classes allow for conversion to each other</li>
<li>in case where target class has more information than source class, missing fields are set to 0</li>
</ul>
<h4 id="datetime-arithmetic">Date/time arithmetic</h4>
<ul>
<li><code>Time</code> objects let you add and subtract seconds, returning a new time object
<ul>
<li><code>Time.now - 10</code>, <code>Time.now + 30</code></li>
</ul>
</li>
<li><code>Date</code> and date/time objects interpret + and - as day-wise operations</li>
<li>use <code>&lt;&lt;</code> and <code>&gt;&gt;</code> for month-wise conversions</li>
<li>a whole family of <code>next_</code>_unit_ and <code>prev_</code>_unit_ methods let you move back and forth by days, months or years</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">dt <span style="color:#f92672">=</span> <span style="color:#66d9ef">DateTime</span><span style="color:#f92672">.</span>now <span style="color:#75715e"># 2020-08-14T07:01:01+10:00</span>
puts dt <span style="color:#f92672">+</span> <span style="color:#ae81ff">10</span> <span style="color:#75715e"># add 10 days: 2020-08-24T07:01:01+10:00</span>
puts dt <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e"># 3 months after: 2020-11-14T07:01:01+10:00</span>
puts dt<span style="color:#f92672">.</span>next <span style="color:#75715e"># 2020-08-15T07:01:01+10:00</span>
puts dt<span style="color:#f92672">.</span>next_year <span style="color:#75715e"># 2021-08-14T07:01:01+10:00</span>
puts dt<span style="color:#f92672">.</span>next_month(<span style="color:#ae81ff">2</span>) <span style="color:#75715e"># 2020-10-14T07:01:01+10:00</span>
puts dt<span style="color:#f92672">.</span>prev_day(<span style="color:#ae81ff">10</span>) <span style="color:#75715e"># 2020-08-04T07:01:01+10:00</span>

d <span style="color:#f92672">=</span> <span style="color:#66d9ef">Date</span><span style="color:#f92672">.</span>today <span style="color:#75715e"># 2020-08-14</span>
next_week <span style="color:#f92672">=</span> d <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span> <span style="color:#75715e"># 2020-08-21</span>
d<span style="color:#f92672">.</span>upto(next_week) { <span style="color:#f92672">|</span>date<span style="color:#f92672">|</span> puts <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74"> is a </span><span style="color:#e6db74">#{</span>date<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%A&#34;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> }
<span style="color:#75715e"># 2020-08-14 is a Friday</span>
<span style="color:#75715e"># 2020-08-15 is a Saturday</span>
<span style="color:#75715e"># 2020-08-16 is a Sunday</span>
<span style="color:#75715e"># 2020-08-17 is a Monday</span>
<span style="color:#75715e"># 2020-08-18 is a Tuesday</span>
<span style="color:#75715e"># 2020-08-19 is a Wednesday</span>
<span style="color:#75715e"># 2020-08-20 is a Thursday</span>
<span style="color:#75715e"># 2020-08-21 is a Friday</span>
</code></pre></div><h2 id="collection-and-container-objects">Collection and container objects</h2>
<ul>
<li>an <em>array</em> is an ordered collection of objects</li>
<li><em>hashes</em> are also ordered collections with objects in pairs</li>
<li>each pair consists of a <em>key</em> and a <em>value</em></li>
</ul>
<h3 id="array">Array</h3>
<ul>
<li>array creation using <code>Array.new</code></li>
<li><code>Array</code> is a method that creates an array with an argument</li>
<li>if the argument has <code>to_ary</code> defined, <code>Array</code> calls it to generate an array</li>
<li>if no <code>to_ary</code> defined, <code>Array</code> tries to call <code>to_a</code></li>
<li>otherwise <code>Array</code> wraps the argument in an array</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> Array<span style="color:#f92672">.</span>new
Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>) <span style="color:#75715e"># [nil, nil, nil]</span>
Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;ab&#34;</span>) <span style="color:#75715e"># [&#34;ab&#34;, &#34;ab&#34;]</span>
Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>) { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) } <span style="color:#75715e"># [10, 20, 30]</span>

Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;ef&#34;</span>) <span style="color:#75715e"># uses the same object &#34;ef&#34;</span>
a<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;g&#34;</span> <span style="color:#75715e"># so this would cause each of the three &#34;ef&#34; become &#34;efg&#34;</span>

Array<span style="color:#f92672">.</span>new(<span style="color:#ae81ff">3</span>) { <span style="color:#e6db74">&#34;abc&#34;</span> } <span style="color:#75715e"># different object &#34;abc&#34;</span>

<span style="color:#75715e"># literal constructor</span>
a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;three&#34;</span>, <span style="color:#ae81ff">4</span>, <span style="color:#f92672">[]]</span>

string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>
Array(string) <span style="color:#75715e"># [&#34;text&#34;]</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">string</span><span style="color:#f92672">.</span><span style="color:#a6e22e">to_a</span>
  split(<span style="color:#e6db74">//</span>)
<span style="color:#66d9ef">end</span>

Array(string) <span style="color:#75715e"># [&#34;t&#34;, &#34;e&#34;, &#34;s&#34;, &#34;t&#34;]</span>
</code></pre></div><ul>
<li>array can be created also with the <code>%w</code> and <code>%W</code> constructor</li>
<li>create array of symbols using <code>%i</code> and <code>%I</code></li>
<li>each of several built-in classes has a class method <code>try_convert</code>
<ul>
<li>it takes one argument, looks for a conversion method</li>
<li>call the conversion method if exists, or return <code>nil</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#75715e"># parsing as single quoted string</span>
<span style="color:#e6db74">%w(Tom Jack)</span> <span style="color:#75715e"># [&#34;Tom&#34;, &#34;Jack&#34;]</span>

<span style="color:#75715e"># parsing as double quoted string</span>
<span style="color:#e6db74">%W{Tom is </span><span style="color:#e6db74">#{</span><span style="color:#ae81ff">10</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> years old}</span> <span style="color:#75715e"># [&#34;Tom&#34;, &#34;is&#34;, &#34;8&#34;, &#34;years&#34;, &#34;old&#34;]</span>

<span style="color:#75715e"># space neeed to be escaped</span>
<span style="color:#e6db74">%w(Black\ Smith is a nice person)</span> <span style="color:#75715e"># [&#34;Black Smith&#34;, &#34;is&#34;, &#34;a&#34;, &#34;nice&#34;, &#34;person&#34;]</span>

<span style="color:#f92672">%</span>i(a b c) <span style="color:#75715e"># [:a, :b, :c]</span>
</code></pre></div><h4 id="array-manipulation">Array manipulation</h4>
<p>Simple getter and setter: <code>[]</code> and <code>[]=</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
a<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;first&#34;</span> <span style="color:#75715e"># a.[]=(0, &#34;first&#34;)</span>
a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
a<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#75715e"># 3</span>
</code></pre></div><p>The getter and setter take a second argument as length:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#e6db74">%w(a quick brown fox jumps over a lazy dog)</span>
a<span style="color:#f92672">[</span><span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#75715e"># [&#34;fox&#34;, &#34;jump&#34;]</span>
a<span style="color:#f92672">[</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;chicken&#34;</span>, <span style="color:#e6db74">&#34;run&#34;</span><span style="color:#f92672">]</span>
<span style="color:#75715e"># a is now [&#34;a&#34;, &#34;quick&#34;, &#34;brown&#34;, &#34;chicken&#34;, &#34;run&#34;, &#34;over&#34;, &#34;a&#34;, &#34;lazy&#34;, &#34;dog&#34;]</span>
a<span style="color:#f92672">.</span>values_at(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">8</span>) <span style="color:#75715e"># [&#34;chicken&#34;, &#34;dog&#34;]</span>
</code></pre></div><ul>
<li>the <code>[]</code> has a synonym: <code>slice</code></li>
<li>there&rsquo;s also <code>slice!</code> that removes sliced items permanently from the array</li>
<li><code>values_at</code> takes one or more arguments representing indexes</li>
<li>elements deep in multi-dimensional array can be retrieved by <code>dig</code></li>
<li><code>dig</code> takes as arguments the index positions of each nested element</li>
<li><code>unshift</code> adds an object to the beginning of an array</li>
<li><code>push</code> adds one or more object to the end of an array</li>
<li><code>&lt;&lt;</code> adds one object to the end of an array</li>
<li><code>shift</code> and <code>pop</code> are the opposite of <code>unshift</code> and <code>push</code>
<ul>
<li>also takes argument for number of elements</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">]</span>
a<span style="color:#f92672">.</span>unshift(<span style="color:#ae81ff">0</span>) <span style="color:#75715e"># [0,1,2,3,4]</span>
a<span style="color:#f92672">.</span>push(<span style="color:#ae81ff">5</span>) <span style="color:#75715e"># [0,1,2,3,4,5]</span>
a <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">6</span> <span style="color:#75715e"># [0,1,2,3,4,5,6]</span>
a<span style="color:#f92672">.</span>push(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>) <span style="color:#75715e"># [0,1,2,3,4,5,6,7,8]</span>
</code></pre></div><ul>
<li>arrays concatenation using <code>concat</code></li>
<li><code>concat</code> permanently changes the receiver</li>
<li>to concatenate and create a new array, use <code>+</code></li>
<li><code>replace</code> replaces array with another</li>
<li><code>replace</code> keeps the object but assignment changes the object</li>
<li>flatten nested array using <code>flatten</code>
<ul>
<li>in-place method exists: <code>flatten!</code></li>
</ul>
</li>
<li><code>reverse</code> reverses an array, also comes with bang version</li>
<li><code>join</code> returns a string representation of all elements together</li>
<li><code>join</code> takes an optional argument for the separator</li>
<li><code>uniq</code> returns an array with duplicates removed</li>
</ul>
<h4 id="array-querying">Array querying</h4>
<table>
<thead>
<tr>
<th>Method name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>`a.size(synonym: length, count) | Number of elemnents in the array                 |</td>
<td></td>
</tr>
<tr>
<td>a.empty?</td>
<td>whether the array is empty</td>
</tr>
<tr>
<td>a.include?(item)</td>
<td>true if the array includes item, false otherwise</td>
</tr>
<tr>
<td>a.count(item)</td>
<td>number of occurrences of item in array</td>
</tr>
<tr>
<td>a.first(n=1)</td>
<td>First <code>n</code> elements of array</td>
</tr>
<tr>
<td>a.last(n=1)</td>
<td>Last <code>n</code> elements of array</td>
</tr>
<tr>
<td>a.sample(n=1)</td>
<td><code>n</code> random elements from array</td>
</tr>
</tbody>
</table>
<h3 id="hashes">Hashes</h3>
<p>Hash is a colection of objects consisting of key/value pairs, the <code>=&gt;</code> operator connects a key on the left with the value corresponding to it on the right.</p>
<p>A hash can be created via:</p>
<ol>
<li>literal constructor (curly braces)
<ul>
<li><code>h = {}</code></li>
</ul>
</li>
<li><code>Hash.new</code> method
<ul>
<li>argument to <code>Hash.new</code> is treated as default value for nonexistent hash keys</li>
</ul>
</li>
<li><code>Hash.[]</code> method
<ul>
<li>takes a comma separated list of items</li>
<li>even number of arguments are treated as alternating keys and values</li>
<li>odd number of argument will raise a fatal error</li>
<li>also can pass an array of arrays, each subarray has two elements</li>
<li><code>Hash[ [[1, 2], [3,4]] ] # {1=&gt;2, 3=&gt;4}</code></li>
</ul>
</li>
<li>top-level method <code>Hash</code>
<ul>
<li>empty hash created when called with empty array or <code>nil</code></li>
<li>otherwise <code>to_hash</code> is called on its single argument</li>
</ul>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">weekdays <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;Monday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Mon&#34;</span>,
             <span style="color:#e6db74">&#34;Tusday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Tue&#34;</span>,
             <span style="color:#e6db74">&#34;Wednesday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Wed&#34;</span>,
             <span style="color:#e6db74">&#34;Thursday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Thur&#34;</span>,
             <span style="color:#e6db74">&#34;Friday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Fri&#34;</span>,
             <span style="color:#e6db74">&#34;Saturday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Sat&#34;</span>,
             <span style="color:#e6db74">&#34;Sunday&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;Sun&#34;</span>}
weekdays<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Monday&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;Mon&#34;</span>
</code></pre></div><p>Adding a key/value pair to a hash:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">country_names<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;US&#34;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;United States&#34;</span>
country_names<span style="color:#f92672">.</span>[]<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;US&#34;</span>, <span style="color:#e6db74">&#34;United States&#34;</span>)
country_names<span style="color:#f92672">.</span>store(<span style="color:#e6db74">&#34;US&#34;</span>, <span style="color:#e6db74">&#34;United States&#34;</span>)
</code></pre></div><p>Retrieving values from a hash:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">country <span style="color:#f92672">=</span> country_names<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;US&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;United States&#34;</span>
country <span style="color:#f92672">=</span> country_names<span style="color:#f92672">.</span>fetch(<span style="color:#e6db74">&#34;US&#34;</span>)
</code></pre></div><p>When looking up a nonexistent key:</p>
<ul>
<li><code>fetch</code> raises and exception</li>
<li><code>[]</code> gives either <code>nil</code> or the default you specified</li>
<li>a second argument to <code>fetch</code> will be used as default when the key isn&rsquo;t found</li>
<li><code>values_at</code> also works on hashes, it returns an array of values for specified keys</li>
<li><code>fetch_values</code> is similar, but raises <code>KeyError</code> if the key isn&rsquo;t found</li>
<li>pass a block to <code>fetch</code> or <code>fetch_values</code> for default behaviour</li>
<li>hashes can be nested within other hashes</li>
<li>similar to <code>Array</code>, <code>dig</code> also exists for hashes</li>
<li>supply a code block to <code>Hash.new</code> to be executed every time a nonexistent key is referenced</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">h <span style="color:#f92672">=</span> <span style="color:#66d9ef">Hash</span><span style="color:#f92672">.</span>new {<span style="color:#f92672">|</span>hash,key<span style="color:#f92672">|</span> hash<span style="color:#f92672">[</span>key<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>}
</code></pre></div><h4 id="combining-hashes-with-other-hashes">Combining hashes with other hashes</h4>
<ul>
<li><code>update</code> add the key-value pairs from second hash to the first, overwrite existing keys</li>
<li><code>merge</code> creates a new hash</li>
<li><code>merge!</code> is a synonym for <code>update</code></li>
</ul>
<h4 id="selecting-and-rejecting-elements-from-a-hash">Selecting and rejecting elements from a hash</h4>
<ul>
<li><code>select</code> with a code block to determine if each key-value pair is included in a new array</li>
<li><code>reject</code> with a code block to determine if each key-value pair should not be included in a new array</li>
<li><code>select</code> and <code>reject</code> have in-place equivalents <code>select!</code> and <code>reject!</code>
<ul>
<li>return <code>nil</code> if the hash doesn&rsquo;t change</li>
<li>to make in-place operation return original hash, use <code>keep_if</code> and <code>delete_if</code></li>
</ul>
</li>
<li><code>Hash#invert</code> flips the keys and the values</li>
<li>be careful since values may not be unique, only one survives with duplicate values</li>
<li><code>Hash#clear</code> empties the hash</li>
<li><code>compact</code> works similarly for hashes as it does for array, eliminating keys whose value is <code>nil</code></li>
<li><code>compact!</code> makes its change in place</li>
<li><code>replace</code> replaces the content of hash with another hash, in place</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">h <span style="color:#f92672">=</span> <span style="color:#66d9ef">Hash</span><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span><span style="color:#f92672">]</span> <span style="color:#75715e"># {1=&gt;2, 3=&gt;4, 5=&gt;6}</span>
h<span style="color:#f92672">.</span>select {<span style="color:#f92672">|</span>k,v<span style="color:#f92672">|</span> k <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>} <span style="color:#75715e"># {3=&gt;4, 5=&gt;6}</span>
h<span style="color:#f92672">.</span>reject {<span style="color:#f92672">|</span>k,v<span style="color:#f92672">|</span> k <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>} <span style="color:#75715e"># {1=&gt;2}</span>
{name: <span style="color:#e6db74">&#34;Tom&#34;</span>, <span style="color:#e6db74">address</span>: <span style="color:#66d9ef">nil</span>}<span style="color:#f92672">.</span>compact <span style="color:#75715e"># {name: &#34;Tom&#34;}</span>
</code></pre></div><h4 id="hash-querying">Hash querying</h4>
<table>
<thead>
<tr>
<th>method</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>h.has_key?(1)</code></td>
<td><code>true</code> if <code>h</code> has the key <code>1</code></td>
</tr>
<tr>
<td><code>h.include?(1)</code></td>
<td>synonym for <code>has_key?</code></td>
</tr>
<tr>
<td><code>h.key?(1)</code></td>
<td>synonym for <code>has_key?</code></td>
</tr>
<tr>
<td><code>h.member?(1)</code></td>
<td>synonym for <code>has_key?</code></td>
</tr>
<tr>
<td><code>h.has_value?(&quot;three&quot;)</code></td>
<td><code>true</code> if any value in <code>h</code> is <code>&quot;three&quot;</code></td>
</tr>
<tr>
<td><code>h.value?(&quot;three&quot;)</code></td>
<td>synonym for <code>has_value?</code></td>
</tr>
<tr>
<td><code>h.empty?</code></td>
<td><code>true</code> if <code>h</code> has no key/value pairs</td>
</tr>
<tr>
<td><code>h.size</code></td>
<td>number of key/value pairs in <code>h</code></td>
</tr>
</tbody>
</table>
<h4 id="hashes-as-final-method-arguments">Hashes as final method arguments</h4>
<p>Ruby allows hash without curly braces when calling a method whose last argument is a hash; If hash is first argument, not only the curly braces are needed, but also the entire arguemnt list need to be in parentheses.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_to_camera_database</span>(owner, info)
  camera <span style="color:#f92672">=</span> <span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>new
  camera<span style="color:#f92672">.</span>owner <span style="color:#f92672">=</span> owner
  camera<span style="color:#f92672">.</span>year_made <span style="color:#f92672">=</span> info<span style="color:#f92672">[</span><span style="color:#e6db74">:year_made</span><span style="color:#f92672">]</span>
  camera<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> info<span style="color:#f92672">[</span><span style="color:#e6db74">:model</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">end</span>

add_to_camera_database(<span style="color:#e6db74">&#34;Tom&#34;</span>,
  <span style="color:#e6db74">year_made</span>: <span style="color:#ae81ff">1991</span>,
  <span style="color:#e6db74">model</span>: <span style="color:#e6db74">&#34;Leica M&#34;</span>)
</code></pre></div><h4 id="named-arguments">Named arguments</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span>(<span style="color:#e6db74">a</span>:, <span style="color:#e6db74">b</span>:)
  p a, b
<span style="color:#66d9ef">end</span>

m(<span style="color:#e6db74">a</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">b</span>: <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># Ruby matches a and b which are required arguments</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span>(<span style="color:#e6db74">a</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">b</span>: <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># default values make arguments optional</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>If the method&rsquo;s parameter list includes a double-starred name, calling a method using keyword arguments not declared by the method will end up sponging up all unknown keyword arguments into a hash:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">m</span>(<span style="color:#e6db74">a</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">b</span>: <span style="color:#ae81ff">2</span>, <span style="color:#f92672">**</span>c)
  p a, b, c
<span style="color:#66d9ef">end</span>

m(<span style="color:#e6db74">x</span>:<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">y</span>:<span style="color:#ae81ff">2</span>)
<span style="color:#75715e"># 1</span>
<span style="color:#75715e"># 2</span>
<span style="color:#75715e"># {:x=&gt;1, :y=&gt;2}</span>
</code></pre></div><h3 id="ranges">Ranges</h3>
<p>A <em>range</em> is an object with a start point and an end point.</p>
<ul>
<li><em>inclusion</em>: does a given value fall inside the range</li>
<li><em>enumeration</em>: the range is treated as a traversable collection of individual items</li>
</ul>
<p>Create a range with <code>Range.new</code> or literal constructor.</p>
<ul>
<li>ranges with two dots are inclusive</li>
<li>ranges with three dots are exclusive</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">r <span style="color:#f92672">=</span> <span style="color:#66d9ef">Range</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>) <span style="color:#75715e"># 1..100</span>
r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">100</span> <span style="color:#75715e"># literal range construction 1..100</span>
r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">...</span><span style="color:#ae81ff">100</span> <span style="color:#75715e"># exclusive range</span>
r <span style="color:#f92672">=</span> <span style="color:#66d9ef">Range</span><span style="color:#f92672">.</span>new(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>, <span style="color:#66d9ef">true</span>) <span style="color:#75715e"># exclusive range 1...100</span>
</code></pre></div><h4 id="range-logic">Range logic</h4>
<ul>
<li>ranges can report back their starting and ending points using <code>begin</code> and <code>end</code></li>
<li>a range also knows whether it&rsquo;s an exclusive range by <code>exclude_end?</code></li>
<li><code>cover?</code> checks whether the argument is within the range using boolean comparison test</li>
<li><code>include?</code> treats range as a collection of values</li>
<li>if the range can&rsquo;t be interpreted as a finite collection, <code>include?</code> falls back on numerical order and comparison</li>
<li>backward range is used usually as index</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">10</span>
r<span style="color:#f92672">.</span>begin <span style="color:#75715e"># 1</span>
r<span style="color:#f92672">.</span>end <span style="color:#75715e"># 10</span>
r<span style="color:#f92672">.</span>exclude_end? <span style="color:#75715e"># false</span>
r <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">..</span><span style="color:#e6db74">&#34;z&#34;</span>
r<span style="color:#f92672">.</span>cover?(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#75715e"># true</span>
r<span style="color:#f92672">.</span>cover?(<span style="color:#e6db74">&#34;abc&#34;</span>) <span style="color:#75715e"># true</span>
r<span style="color:#f92672">.</span>cover?(<span style="color:#e6db74">&#34;A&#34;</span>) <span style="color:#75715e"># false</span>
r<span style="color:#f92672">.</span>cover?(<span style="color:#f92672">[]</span>) <span style="color:#75715e"># false</span>
r<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#75715e"># true</span>
r<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#34;abc&#34;</span>) <span style="color:#75715e"># false</span>
r <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">2</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>
r<span style="color:#f92672">.</span>include?(<span style="color:#ae81ff">1</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span>) <span style="color:#75715e"># true</span>
<span style="color:#e6db74">&#34;This is a sample string&#34;</span><span style="color:#f92672">[</span><span style="color:#ae81ff">10</span><span style="color:#f92672">..-</span><span style="color:#ae81ff">5</span><span style="color:#f92672">]</span> <span style="color:#75715e"># sample st</span>
</code></pre></div><h3 id="sets">Sets</h3>
<ul>
<li><code>Set</code> is a standard library class, need <code>require 'set'</code></li>
<li>a <em>set</em> is a unique collection of objects</li>
<li>internally hash is used, a new key is added to the hash when an element is added to set</li>
</ul>
<p>Create a new <code>Set</code> by providing a collection object, can also provide a code block which every item in the collection object is passed through.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">cameras <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Leica M&#34;</span>, <span style="color:#e6db74">&#34;X-Pro3&#34;</span>, <span style="color:#e6db74">&#34;GX9&#34;</span>, <span style="color:#e6db74">&#34;Leica M&#34;</span><span style="color:#f92672">]</span>
unique_cameras <span style="color:#f92672">=</span> <span style="color:#66d9ef">Set</span><span style="color:#f92672">.</span>new(cameras) <span style="color:#75715e"># #&lt;Set: {&#34;Leica M&#34;, &#34;X-Pro3&#34;, &#34;GX9&#34;}&gt;</span>
unique_cameras <span style="color:#f92672">=</span> <span style="color:#66d9ef">Set</span><span style="color:#f92672">.</span>new(cameras) {<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c<span style="color:#f92672">.</span>upcase} <span style="color:#75715e"># #&lt;Set: {&#34;LEICA M&#34;, &#34;X-PRO3&#34;, &#34;GX9&#34;}&gt;</span>
</code></pre></div><ul>
<li>use <code>&lt;&lt;</code> to add a single object to a set, nothing happens if adding a duplicated object</li>
<li>use <code>delete</code> to delete an object from a set, nothing happens if the object doesn&rsquo;t exist</li>
<li><code>&lt;&lt;</code> is also available as <code>add</code></li>
<li><code>add?</code> returns <code>nil</code> if set is unchagned after adding an object
<ul>
<li>this is usually used to determine whether the object already exists</li>
</ul>
</li>
</ul>
<h4 id="set-operations">Set operations</h4>
<ul>
<li><code>intersection</code>, aliased as <code>&amp;</code></li>
<li><code>union</code>, aliased as <code>+</code> and <code>|</code></li>
<li><code>difference</code>, aliased as <code>-</code></li>
<li><code>^</code> exclusive or, a set consisting of elements that occur in either set but not all</li>
<li>merging another object into a set depends on how the object iterates over itself
<ul>
<li>merging a hash into a set results in the addition of two-element, key/value arrays to the set</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">camera_brands <span style="color:#f92672">=</span> <span style="color:#66d9ef">Set</span><span style="color:#f92672">.</span>new(<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Leica&#34;</span>, <span style="color:#e6db74">&#34;Fujifilm&#34;</span>, <span style="color:#e6db74">&#34;Olympus&#34;</span><span style="color:#f92672">]</span>)
closed_brands <span style="color:#f92672">=</span> <span style="color:#66d9ef">Set</span><span style="color:#f92672">.</span>new(<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Olympus&#34;</span><span style="color:#f92672">]</span>)
optics_brands <span style="color:#f92672">=</span> <span style="color:#66d9ef">Set</span><span style="color:#f92672">.</span>new(<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Zeiss&#34;</span>, <span style="color:#e6db74">&#34;Leica&#34;</span><span style="color:#f92672">]</span>)
camera_brands <span style="color:#f92672">-</span> closed_brands <span style="color:#75715e"># &lt;Set: {&#34;Leica&#34;, &#34;Fujifilm&#34;}&gt;</span>
camera_brands <span style="color:#f92672">+</span> optics_brands <span style="color:#75715e"># &lt;Set: {&#34;Leica&#34;, &#34;Fujifilm&#34;, &#34;Olympus&#34;, &#34;Zeiss&#34;}&gt;</span>
camera_brands <span style="color:#f92672">&amp;</span> optics_brands <span style="color:#75715e"># &lt;Set: {&#34;Leica&#34;}&gt;</span>
</code></pre></div><h4 id="subset-and-superset">Subset and superset</h4>
<ul>
<li><code>subset?</code> and <code>superset?</code> exist to check subset and superset relation</li>
<li><code>proper_subset?</code> and <code>proper_superset?</code> also make sure superset is bigger and subset is smaller than the original set</li>
</ul>
<h2 id="enumerable-and-enumerator">Enumerable and Enumerator</h2>
<p>Collection objects in Ruby typically include the <code>Enumerable</code> module for common functionalities.</p>
<ul>
<li>each class that uses <code>Enumerable</code> has to define the instance method <code>each</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">C</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Enumerable</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each</span>
    <span style="color:#75715e"># code</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>The job of <code>each</code> is to yield items to a supplied code block, one at a time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Gender</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Enumerable</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each</span>
    <span style="color:#66d9ef">yield</span> <span style="color:#e6db74">&#34;boy&#34;</span>
    <span style="color:#66d9ef">yield</span> <span style="color:#e6db74">&#34;girl&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

g <span style="color:#f92672">=</span> <span style="color:#66d9ef">Gender</span><span style="color:#f92672">.</span>new
g<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>gender<span style="color:#f92672">|</span>
  puts <span style="color:#e6db74">&#34;Gender: </span><span style="color:#e6db74">#{</span>gender<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># output:</span>
<span style="color:#75715e"># Gender: boy</span>
<span style="color:#75715e"># Gender: girl</span>
</code></pre></div><p><code>find</code> works by calling <code>each</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">g <span style="color:#f92672">=</span> <span style="color:#66d9ef">Gender</span><span style="color:#f92672">.</span>new
g<span style="color:#f92672">.</span>find {<span style="color:#f92672">|</span>gender<span style="color:#f92672">|</span> g<span style="color:#f92672">.</span>start_with?(<span style="color:#e6db74">&#39;b&#39;</span>) }
<span style="color:#75715e"># output: boy</span>
</code></pre></div><h3 id="enumerable-boolean-queries">Enumerable Boolean queries</h3>
<p>A number of <code>Enumerable</code> methods return true or false depending on whether one or more elements matching certain criteria.</p>
<table>
<thead>
<tr>
<th>method</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>include?</code></td>
<td>whether the enumerable includes specified object</td>
</tr>
<tr>
<td><code>all?</code></td>
<td>whether ALL elements match query</td>
</tr>
<tr>
<td><code>any?</code></td>
<td>whether ANY element matches query</td>
</tr>
<tr>
<td><code>one?</code></td>
<td>is there one and only one element matching query</td>
</tr>
<tr>
<td><code>none?</code></td>
<td>is there NO element matching query</td>
</tr>
</tbody>
</table>
<ul>
<li>above methods work also for hashes</li>
<li><code>Hash#each</code> yields both a key and a value each time</li>
<li>you can also capture the key/value pair in a single block parameter
<ul>
<li><code>hash.each {|pair| …}</code> with <code>pair[0]</code> for key and <code>pair[1]</code> for value</li>
</ul>
</li>
<li>set works naturally with <code>Enumerable</code></li>
<li>ranges works only if the range can be expressed as a list of discrete elements</li>
</ul>
<h3 id="enumerable-searching-and-selecting">Enumerable searching and selecting</h3>
<p><code>find</code> locates the first element in an array for which the code block returns true, failing to find any element that passes code block test would return <code>nil</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">9</span><span style="color:#f92672">].</span>find {<span style="color:#f92672">|</span>n<span style="color:#f92672">|</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>}
<span style="color:#75715e"># output: 4</span>
</code></pre></div><p>As a result, if the array has <code>nil</code> as an element, looking for <code>nil</code> would always return <code>nil</code>. Use <code>include?</code> as a work around to check whether the array has <code>nil</code> as an element. Alternatively, provide a <code>Proc</code> object as an argument to find, the function will be called if <code>find</code> fails.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">failure <span style="color:#f92672">=</span> lambda { <span style="color:#ae81ff">11</span> }
over_ten <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span><span style="color:#f92672">].</span>find(failure) {<span style="color:#f92672">|</span>n<span style="color:#f92672">|</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span> }
<span style="color:#75715e"># output: 11</span>
</code></pre></div><p><code>find_all</code> (the same as <code>select</code>) returns a new collection containing all the elements of the original collection that match the criteria in the code block, empty collection is returned if none is found.</p>
<p><code>select</code> generally returns an array, include using <code>Enumerable</code> in your own class, but for hashes and sets, <code>select</code> returns a hash or set, respectively.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">10</span><span style="color:#f92672">]</span>
a<span style="color:#f92672">.</span>find_all {<span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> item <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span> } <span style="color:#75715e"># [6, 7, 8, 9, 10]</span>
a<span style="color:#f92672">.</span>select {<span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> item <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> } <span style="color:#75715e"># []</span>
</code></pre></div><p>Arrays, hashes and sets have a bang version <code>select!</code> that reduces the collection permanently to only those elements that passed the selection test.</p>
<p><code>reject</code> finds out which elements do not return a true value when yielded to the code block:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a<span style="color:#f92672">.</span>reject {<span style="color:#f92672">|</span>item<span style="color:#f92672">|</span> item <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>} <span style="color:#75715e"># [1, 2, 3, 4, 5]</span>
</code></pre></div><p>There&rsquo;s also the bang version <code>reject!</code></p>
<h4 id="selecting-on-threequal-matches-with-grep">Selecting on threequal matches with grep</h4>
<p><code>Enumerable#grep</code> selects from an enumerable object based on case-equality operator <code>===</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">misc <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#34;hi&#34;</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">..</span><span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#34;bye&#34;</span><span style="color:#f92672">]</span>
misc<span style="color:#f92672">.</span>grep(String) <span style="color:#75715e"># [&#34;hi&#34;, &#34;bye&#34;]</span>
misc<span style="color:#f92672">.</span>grep(<span style="color:#ae81ff">10</span><span style="color:#f92672">..</span><span style="color:#ae81ff">20</span>) <span style="color:#75715e"># [12]</span>
</code></pre></div><p><code>enumerable.grep(expression)</code> is equivalent to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">enumerable<span style="color:#f92672">.</span>select {<span style="color:#f92672">|</span>element<span style="color:#f92672">|</span> expression <span style="color:#f92672">===</span> element }
</code></pre></div><ul>
<li><code>grep</code> can also take a block, it yields each element of its result set to the block</li>
</ul>
<h4 id="organizing-selection-results-with-group_by-and-partition">Organizing selection results with group_by and partition</h4>
<ul>
<li><code>group_by</code> on enumerable object takes a block and returns a hash</li>
<li>the block is executed for each object</li>
<li>result hash gets a key for each unique block return value</li>
<li>value for the key is an array of all elements that the block returned that value</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">colors <span style="color:#f92672">=</span> <span style="color:#e6db74">%w(red orange yellow green blue indigo violet)</span>
colors<span style="color:#f92672">.</span>group_by {<span style="color:#f92672">|</span>color<span style="color:#f92672">|</span> color<span style="color:#f92672">.</span>size }
<span style="color:#75715e"># output:</span>
<span style="color:#75715e"># {3=&gt;[&#34;red&#34;], 6=&gt;[&#34;orange&#34;, &#34;yellow&#34;, &#34;indigo&#34;, &#34;violet&#34;], 5=&gt;[&#34;green&#34;], 4=&gt;[&#34;blue&#34;]}</span>
</code></pre></div><ul>
<li><code>partition</code> splits the elements into two arrays based on whether the code block returns true for the element</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Camera</span>
  <span style="color:#66d9ef">attr_accessor</span> <span style="color:#e6db74">:price</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>(options)
    self<span style="color:#f92672">.</span>price <span style="color:#f92672">=</span> options<span style="color:#f92672">[</span><span style="color:#e6db74">:price</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">below</span>(limit)
    (<span style="color:#ae81ff">0</span><span style="color:#f92672">...</span>limit) <span style="color:#f92672">===</span> price
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

cameras <span style="color:#f92672">=</span> <span style="color:#ae81ff">900</span><span style="color:#f92672">.</span>step(<span style="color:#ae81ff">1200</span>, <span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>map {<span style="color:#f92672">|</span>p<span style="color:#f92672">|</span> <span style="color:#66d9ef">Camera</span><span style="color:#f92672">.</span>new(<span style="color:#e6db74">:price</span> <span style="color:#f92672">=&gt;</span> p) }

cameras<span style="color:#f92672">.</span>partition { <span style="color:#f92672">|</span>camera<span style="color:#f92672">|</span> camera<span style="color:#f92672">.</span>below(<span style="color:#ae81ff">1000</span>) }
<span style="color:#75715e"># output:</span>
<span style="color:#75715e"># [[#&lt;Camera:0x00007feb871e48b0 @price=900&gt;, #&lt;Camera:0x00007feb871e4838 @price=950&gt;], [#&lt;Camera:0x00007feb871e4798 @price=1000&gt;, #&lt;Camera:0x00007feb871e46f8 @price=1050&gt;, #&lt;Camera:0x00007feb871e4680 @price=1100&gt;, #&lt;Camera:0x00007feb871e4608 @price=1150&gt;, #&lt;Camera:0x00007feb871e4590 @price=1200&gt;]]</span>
</code></pre></div><h3 id="element-wise-operations">Element-wise operations</h3>
<ul>
<li><code>Enumerable#first</code> returns the first item when iterating over the enumerable</li>
<li>there is no <code>Enumerable#last</code> as not all enumerables have end</li>
<li>some enumerable classes do have <code>last</code> method: <code>Array</code> and <code>Range</code></li>
<li><code>take(n)</code> gets n elements, <code>drop(n)</code> gets original collection without the n elements</li>
<li>use <code>take_while</code> and <code>drop_while</code> with a code block to constrain the size of &ldquo;take&rdquo; by the truth value of the code block</li>
<li><code>min</code> and <code>max</code> returns the minimum and maximum element
<ul>
<li>determined by <code>&lt;=&gt;</code> logic</li>
<li>can provide a code block to perform non-default criteria</li>
</ul>
</li>
<li><code>minmax</code> and <code>minmax_by</code> returns a pair of values for minimum and maximum</li>
<li><code>min</code> and <code>max</code> for hashes use the keys to determine ordering
<ul>
<li>use <code>*_by</code> if you want to use values</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Die</span>
  <span style="color:#66d9ef">include</span> <span style="color:#66d9ef">Enumerable</span>
  <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">each</span>
    <span style="color:#66d9ef">loop</span> <span style="color:#66d9ef">do</span>
      <span style="color:#66d9ef">yield</span> rand(<span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

d <span style="color:#f92672">=</span> <span style="color:#66d9ef">Die</span><span style="color:#f92672">.</span>new
d<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>roll<span style="color:#f92672">|</span>
  <span style="color:#66d9ef">if</span> roll <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>
    puts <span style="color:#e6db74">&#34;Start&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

cameras
<span style="color:#75715e"># [#&lt;Camera:0x00007feb871e48b0 @price=900&gt;, #&lt;Camera:0x00007feb871e4838 @price=950&gt;, #&lt;Camera:0x00007feb871e4798 @price=1000&gt;, #&lt;Camera:0x00007feb871e46f8 @price=1050&gt;, #&lt;Camera:0x00007feb871e4680 @price=1100&gt;, #&lt;Camera:0x00007feb871e4608 @price=1150&gt;, #&lt;Camera:0x00007feb871e4590 @price=1200&gt;]</span>

cameras<span style="color:#f92672">.</span>take_while {<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c<span style="color:#f92672">.</span>below(<span style="color:#ae81ff">1000</span>) }
<span style="color:#75715e"># [#&lt;Camera:0x00007feb871e48b0 @price=900&gt;, #&lt;Camera:0x00007feb871e4838 @price=950&gt;]</span>

cameras<span style="color:#f92672">.</span>drop_while {<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c<span style="color:#f92672">.</span>below(<span style="color:#ae81ff">1000</span>) }
<span style="color:#75715e"># [#&lt;Camera:0x00007feb871e4798 @price=1000&gt;, #&lt;Camera:0x00007feb871e46f8 @price=1050&gt;, #&lt;Camera:0x00007feb871e4680 @price=1100&gt;, #&lt;Camera:0x00007feb871e4608 @price=1150&gt;, #&lt;Camera:0x00007feb871e4590 @price=1200&gt;]</span>

cameras<span style="color:#f92672">.</span>min {<span style="color:#f92672">|</span>a,b<span style="color:#f92672">|</span> a<span style="color:#f92672">.</span>price <span style="color:#f92672">&lt;=&gt;</span> b<span style="color:#f92672">.</span>price}
<span style="color:#75715e"># &lt;Camera:0x00007feb871e48b0 @price=900&gt;</span>

cameras<span style="color:#f92672">.</span>max {<span style="color:#f92672">|</span>a,b<span style="color:#f92672">|</span> a<span style="color:#f92672">.</span>price <span style="color:#f92672">&lt;=&gt;</span> b<span style="color:#f92672">.</span>price}
<span style="color:#75715e"># &lt;Camera:0x00007feb871e4590 @price=1200&gt;</span>
</code></pre></div><ul>
<li><code>reverse_each</code> is <code>each</code> but reversely
<ul>
<li>do not use it on infinite iterator</li>
</ul>
</li>
<li><code>Enumerable#each_with_index</code> yields an extra integer representing the ordinal position of the item
<ul>
<li><code>each_with_index</code> is deprected, use <code>each.with_index</code> instead</li>
</ul>
</li>
<li>provide an argument to <code>each.with_index</code> as the first index value, avoiding the need to add one to the index which by default starts from 0</li>
<li><code>each_slice</code> and <code>each_cons</code> walk through a collection a certain number of elements at a time</li>
<li><code>each_slice</code> handles each element only once</li>
<li><code>each_cons</code> takes a new grouping at each element with overlapping yielded arrays</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> Array(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">10</span>)

a<span style="color:#f92672">.</span>each_slice(<span style="color:#ae81ff">3</span>) {<span style="color:#f92672">|</span>slice<span style="color:#f92672">|</span> p slice }
<span style="color:#75715e"># [1, 2, 3]</span>
<span style="color:#75715e"># [4, 5, 6]</span>
<span style="color:#75715e"># [7, 8, 9]</span>
<span style="color:#75715e"># [10]</span>

a<span style="color:#f92672">.</span>each_cons(<span style="color:#ae81ff">3</span>) {<span style="color:#f92672">|</span>slice<span style="color:#f92672">|</span> p slice }
<span style="color:#75715e"># [1, 2, 3]</span>
<span style="color:#75715e"># [2, 3, 4]</span>
<span style="color:#75715e"># [3, 4, 5]</span>
<span style="color:#75715e"># [4, 5, 6]</span>
<span style="color:#75715e"># [5, 6, 7]</span>
<span style="color:#75715e"># [6, 7, 8]</span>
<span style="color:#75715e"># [7, 8, 9]</span>
<span style="color:#75715e"># [8, 9, 10]</span>
</code></pre></div><p>There&rsquo;s a family of <code>slice_</code> methods.</p>
<ul>
<li><code>slice_before</code> split a collection at the point at which a given criterion is matched</li>
<li><code>slice_after</code> complements <code>slice_before</code>, split a collection after the pattern or Boolean test is found</li>
<li><code>slice_when</code> tests two elements at a time</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">(<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">10</span>)<span style="color:#f92672">.</span>slice_before { <span style="color:#f92672">|</span>num<span style="color:#f92672">|</span> num <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> }<span style="color:#f92672">.</span>to_a
<span style="color:#75715e"># [[1], [2, 3], [4, 5], [6, 7], [8, 9], [10]]</span>

<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">10</span><span style="color:#f92672">].</span>slice_when { <span style="color:#f92672">|</span>i,j<span style="color:#f92672">|</span> i <span style="color:#f92672">==</span> j }<span style="color:#f92672">.</span>to_a
<span style="color:#75715e"># [[1, 2, 3], [3, 4, 5, 6], [6, 7, 8], [8], [8, 9, 10]]</span>
</code></pre></div><p><code>Enumerable#cycle</code> yields all the elements in the object again and again in a loop, providing an integer argument asks the loop to run that many times.</p>
<h4 id="enumerable-reduction-with-inject">Enumerable reduction with inject</h4>
<p><code>inject</code> works by initializing an accumulator oject and iterating through a collection, performing a calculation on each iteration and resetting the acumulator for purposes of the next iteration, to the result of that calculation.</p>
<ul>
<li>without an argument to inject it uses the first element in the enumerable object as the initial value</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>inject(<span style="color:#ae81ff">0</span>) {<span style="color:#f92672">|</span>acc,n<span style="color:#f92672">|</span> acc <span style="color:#f92672">+</span> n } <span style="color:#75715e"># 10</span>
<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span><span style="color:#f92672">].</span>inject(<span style="color:#e6db74">:+</span>)
</code></pre></div><h4 id="map">Map</h4>
<ul>
<li><code>map</code> (also callable as <code>collect</code>) always returns an array of the same size as the original enumerable</li>
<li>the elements of returned array consist of the accumulated result of calling the code block on each element in the original object</li>
<li><code>each</code> exists purely for the side effects from the execution of the block</li>
<li><code>map</code> on the other hand maintains an accumulator array of the results from the block</li>
<li><code>map</code> has a in-place <code>map!</code>, defined in <code>Array</code> and <code>Set</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">cameras <span style="color:#f92672">=</span> <span style="color:#e6db74">%w(Leica Fujifilm Olympus)</span>
cameras<span style="color:#f92672">.</span>map {<span style="color:#f92672">|</span>camera<span style="color:#f92672">|</span> camera<span style="color:#f92672">.</span>upcase} <span style="color:#75715e"># [&#34;LEICA&#34;, &#34;FUJIFILM&#34;, &#34;OLYMPUS&#34;]</span>

<span style="color:#75715e"># use a symbol argument as a block</span>
cameras<span style="color:#f92672">.</span>map(<span style="color:#f92672">&amp;</span><span style="color:#e6db74">:upcase</span>)
</code></pre></div><p>Be careful with block evaluation, <code>map</code> only cares about return value of <code>puts</code> which is always <code>nil</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">array <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
result <span style="color:#f92672">=</span> array<span style="color:#f92672">.</span>map {<span style="color:#f92672">|</span>n<span style="color:#f92672">|</span> puts n <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span> } <span style="color:#75715e"># [nil, nil, nil, nil, nil]</span>
</code></pre></div><h4 id="strings-as-enumerables">Strings as enumerables</h4>
<ul>
<li><code>String</code> has <code>each_byte</code>, <code>each_character</code> and <code>each_codepoint</code></li>
<li><code>String</code> has <code>each_line</code> that splits the string at the end of each occurrence of global variable <code>$/</code></li>
<li><code>$/</code> is linebreak by default, can be changed</li>
<li>drop the <code>each_</code> and pluralize the method name give array of all data instead of enumerator</li>
</ul>
<h4 id="sorting-enumerables">Sorting enumerables</h4>
<p>In order to make a class instance sortable:</p>
<ol>
<li>define <code>&lt;=&gt;</code> for the class</li>
<li>place multiple instances in a container, e.g. array</li>
<li>sort the container</li>
</ol>
<p>In cases where no <code>&lt;=&gt;</code> is defined for objects, a block can be supplied on the fly to indicate how they should be sorted.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">sorted_camera <span style="color:#f92672">=</span> cameras<span style="color:#f92672">.</span>sort <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>a, b<span style="color:#f92672">|</span>
  a<span style="color:#f92672">.</span>price <span style="color:#f92672">&lt;=&gt;</span> b<span style="color:#f92672">.</span>price
<span style="color:#66d9ef">end</span>
</code></pre></div><ul>
<li><code>sort_by</code> always takes a block that requires a treatment of one item in the collection.</li>
<li><code>clamp</code> takes two argument, returns 1st argument if receiver is less, returns 2nd argument is receiver is greater, otherwise returns the receiver itself</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">cameras<span style="color:#f92672">.</span>sort_by {<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c<span style="color:#f92672">.</span>price }
cameras<span style="color:#f92672">.</span>sort_by(<span style="color:#f92672">&amp;</span><span style="color:#e6db74">:price</span>)
</code></pre></div><h3 id="enumeraors">Enumeraors</h3>
<ul>
<li>an <code>iterator</code> is a method that yields one or more values to a code block</li>
<li>an enumerator is an object</li>
<li>at heart, an enumerator is a simple enumerable object with an <code>each</code> and employs the <code>Enumerable</code> module</li>
<li>an enumerator isn&rsquo;t a container object, the <code>each</code> logic has to be explicitly specified</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">e <span style="color:#f92672">=</span> <span style="color:#66d9ef">Enumerator</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>y<span style="color:#f92672">|</span>
  y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>
  y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span>
  y <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">end</span>

e <span style="color:#f92672">=</span> <span style="color:#66d9ef">Enumerator</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>y<span style="color:#f92672">|</span>
  (<span style="color:#ae81ff">1</span><span style="color:#f92672">..</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">.</span>each { <span style="color:#f92672">|</span>i<span style="color:#f92672">|</span> y <span style="color:#f92672">&lt;&lt;</span> i }
<span style="color:#66d9ef">end</span>

e<span style="color:#f92672">.</span>to_a <span style="color:#75715e"># [1, 2, 3]</span>
e<span style="color:#f92672">.</span>map {<span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>} <span style="color:#75715e"># [10, 20, 30]</span>
e<span style="color:#f92672">.</span>select {<span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>} <span style="color:#75715e"># [2, 3]</span>
e<span style="color:#f92672">.</span>take(<span style="color:#ae81ff">2</span>) <span style="color:#75715e"># [1, 2]</span>
</code></pre></div><ul>
<li><code>y</code> is a <em>yielder</em>, an instance of <code>Enumerator::Yielder</code> passed to your block</li>
<li>upon <code>each</code>, 1, 2 and 3 are yielded, can also be <code>y.yield(1)</code></li>
<li>every time the iterator method on the enumerator is called, the code block gets executed once</li>
<li>it&rsquo;s also possible to involve other objects in the code block</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">a <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">]</span>
e <span style="color:#f92672">=</span> <span style="color:#66d9ef">Enumerator</span><span style="color:#f92672">.</span>new <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>y<span style="color:#f92672">|</span>
  total <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">until</span> a<span style="color:#f92672">.</span>empty?
    total <span style="color:#f92672">+=</span> a<span style="color:#f92672">.</span>pop
    y <span style="color:#f92672">&lt;&lt;</span> total
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>

e<span style="color:#f92672">.</span>take(<span style="color:#ae81ff">2</span>) <span style="color:#75715e"># [5, 9], popping and adding last two</span>
a <span style="color:#75715e"># [1, 2, 3]</span>
e<span style="color:#f92672">.</span>to_a <span style="color:#75715e"># [3, 5, 6], each would pop and add to total until empty</span>
</code></pre></div><h4 id="attaching-enumerators-to-other-objects">Attaching enumerators to other objects</h4>
<p>When the enumerator need to yield something, it gets the necessary value by triggering the next yield from the object to which it is attached via the designated method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">cameras <span style="color:#f92672">=</span> <span style="color:#e6db74">%w(Leica Olympus Canon Nikon)</span>
e <span style="color:#f92672">=</span> cameras<span style="color:#f92672">.</span>enum_for(<span style="color:#e6db74">:select</span>)
e<span style="color:#f92672">.</span>each {<span style="color:#f92672">|</span>c<span style="color:#f92672">|</span> c<span style="color:#f92672">.</span>include?(<span style="color:#e6db74">&#39;o&#39;</span>)} <span style="color:#75715e"># [&#34;Canon&#34;, &#34;Nikon&#34;]</span>
</code></pre></div><p>Any further arguments provided to <code>enum_for</code> are passed through to the method to which the enumerator is being attached.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">e <span style="color:#f92672">=</span> cameras<span style="color:#f92672">.</span>enum_for(<span style="color:#e6db74">:inject</span>, <span style="color:#e6db74">&#34;Names: &#34;</span>)
e<span style="color:#f92672">.</span>each {<span style="color:#f92672">|</span>string, name<span style="color:#f92672">|</span> string <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">#{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#34;</span> }
<span style="color:#75715e"># &#34;Names: Leica...Olympus...Canon...Nikon...&#34;</span>
</code></pre></div><ul>
<li>the starting string &ldquo;Names: &quot; is still alive inside the enumerator</li>
<li>most built-in iterators return an enumerator when they&rsquo;re called without a block</li>
<li>the main use for this is <em>chaining</em>: calling another method imeediately on the enumerator</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">e <span style="color:#f92672">=</span> cameras<span style="color:#f92672">.</span>map
e<span style="color:#f92672">.</span>each {<span style="color:#f92672">|</span>camera<span style="color:#f92672">|</span> camera<span style="color:#f92672">.</span>capitalize}
</code></pre></div><h2 id="regular-expression">Regular Expression</h2>
<ul>
<li>Regular expressio in Ruby are objects of <code>Regexp</code> class</li>
<li>its purposes is to specify character patterns determined to match (or not match) strings</li>
<li>a number of Ruby built-in methods take regular expressions as regular expressions
<ul>
<li><code>scan</code>, <code>substitude</code>, <code>split</code></li>
</ul>
</li>
</ul>
<p>Examples of patterns:</p>
<ul>
<li>the letter <code>a</code> followed by a digit</li>
<li>any uppercase letter followed by at least one lowercase letter</li>
<li>three digits followed by a hyphen and four digits</li>
<li>the beginning of a line followed by one or more whitespaces</li>
<li>a specific character at the end of a string</li>
</ul>
<p>Regular expression are instances of <code>Regexp</code> class, which has literal constructor <code>//</code> and <code>%r{}</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#f92672">&gt;&gt;</span> <span style="color:#e6db74">//</span><span style="color:#f92672">.</span>class
<span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Regexp</span>

<span style="color:#f92672">&gt;&gt;</span> <span style="color:#e6db74">%r{}</span><span style="color:#f92672">.</span>class
<span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">Regexp</span>
</code></pre></div><p>Any pattern matching operation involves a regexp and a string. The simplest way to find out whether there&rsquo;s a match between a pattern and a string is with the <code>match</code> method or its sibling <code>match?</code>. Ruby also features a pattern-matching operator <code>=~</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#e6db74">&#34;A quick brown fox jumps over a lazy dog.&#34;</span><span style="color:#f92672">.</span>match?(<span style="color:#e6db74">/fox/</span>)
<span style="color:#e6db74">/fox/</span><span style="color:#f92672">.</span>match?(<span style="color:#e6db74">&#34;A quick brown fox jumps over a lazy dog.&#34;</span>)

puts <span style="color:#e6db74">&#34;Match!&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">/Hello/</span> <span style="color:#f92672">=~</span> <span style="color:#e6db74">&#34;Hello world!&#34;</span>
puts <span style="color:#e6db74">&#34;Match!&#34;</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Hello world!&#34;</span> <span style="color:#f92672">=~</span> <span style="color:#e6db74">/Hello/</span>
</code></pre></div><ul>
<li><code>match?</code> returns a boolean whereas <code>match</code> returns a <code>MatchData</code> or <code>nil</code></li>
<li><code>=~</code> returns the numerical index of the character in the string where the match starts</li>
</ul>
<table>
<thead>
<tr>
<th>symbol</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>//</code>, <code>%r{}</code></td>
<td>instance of <code>Regexp</code> class</td>
</tr>
<tr>
<td><code>=~</code></td>
<td>determines if a match exists</td>
</tr>
<tr>
<td><code>.</code></td>
<td>matches any character except <code>\n</code></td>
</tr>
<tr>
<td><code>\</code></td>
<td>escape character, treat next character as literal</td>
</tr>
<tr>
<td><code>[]</code></td>
<td>surrounds a character class, matches either character between <code>[</code> and <code>]</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>1. negates a character or character class, matches anything <em>except</em> what follows <code>^</code></td>
</tr>
<tr>
<td><code>^</code></td>
<td>2. matches the expression at the start of a line</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>matches any digit</td>
</tr>
<tr>
<td><code>\D</code></td>
<td>matches anything except a digit</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>matches any digit, alphabets or underscore</td>
</tr>
<tr>
<td><code>\W</code></td>
<td>matches anything except a digit, alphabets or underscore</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>matches any whitespace characters (space, tab, newline)</td>
</tr>
<tr>
<td><code>\S</code></td>
<td>matches anything except a white space character</td>
</tr>
<tr>
<td><code>{}</code></td>
<td>matches a character or character class a specific number of times</td>
</tr>
<tr>
<td><code>$</code></td>
<td>matches the expression at the end of a line</td>
</tr>
<tr>
<td><code>+</code></td>
<td>matches one or more occurrences of the character or character class</td>
</tr>
<tr>
<td><code>*</code></td>
<td>matches zero or more occurrences of the character or character class</td>
</tr>
</tbody>
</table>
<p>A regexp includes three possible components:</p>
<ol>
<li>literal characters</li>
<li>the dot wildcard (.), matches any character except <code>\n</code></li>
<li>character class</li>
</ol>
<ul>
<li>any literal character in a regexp matches itself in the string
<ul>
<li>e.g. <code>/b/</code> matches any string containing letter <code>b</code></li>
</ul>
</li>
<li>some non-alphanumeric characters have special meanings and need to be <em>escaped</em> to match
<ul>
<li>e.g. <code>/\?/</code></li>
</ul>
</li>
<li>using <code>%r{}</code> syntax doesn&rsquo;t need to escape <code>/</code></li>
</ul>
<p>The dot widecard character matches <em>any character</em> at some point in the pattern, except of a newline.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#f92672">&gt;&gt;</span> <span style="color:#e6db74">/.ization/</span><span style="color:#f92672">.</span>match?(<span style="color:#e6db74">&#34;internationalization&#34;</span>)
<span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>
</code></pre></div><ul>
<li>a <em>character class</em> is an explicit list of characters placed inside square brackets</li>
<li>also can insert a <em>range</em> of characters</li>
<li><em>negating</em> a character class using caret (^) at the beginning of the class</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">regex <span style="color:#f92672">=</span> <span style="color:#e6db74">%r{[ps]lot}</span>
regex<span style="color:#f92672">.</span>match?(<span style="color:#e6db74">&#34;slot&#34;</span>) <span style="color:#75715e"># true</span>
regex<span style="color:#f92672">.</span>match?(<span style="color:#e6db74">&#34;alot&#34;</span>) <span style="color:#75715e"># false</span>

<span style="color:#e6db74">/[a-z]/</span>
<span style="color:#e6db74">/[A-Fa-f0-9]/</span>

<span style="color:#e6db74">%r{[^A-Fa-f0-9]}</span> <span style="color:#75715e"># not hex number</span>
</code></pre></div><h3 id="matchdata">MatchData</h3>
<p>Use parentheses to specify <em>captures</em> in regexp construction.</p>
<p>e.g. to extract book name from the following line:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;the old man and the sea, Hemingway, Mr., writer&#39;</span>
regex <span style="color:#f92672">=</span> <span style="color:#e6db74">/([A-Za-z\s]+),[A-Za-z\s]+,[\s]?(Mrs?\.)/</span>
m <span style="color:#f92672">=</span> regex<span style="color:#f92672">.</span>match(line)
m<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;the old man and the sea, Hemingway, Mr.&#34;</span>
</code></pre></div><ul>
<li>the question mark after <code>s</code> means <em>match zero or one <code>s</code></em></li>
<li>the result is a <code>MatchData</code> object with access to the submatches</li>
<li>Ruby populates global variables based on numbers</li>
<li><code>$1</code> contains the substring matched by the subpattern inside the <em>first set of parentheses from the left</em> in the regexp</li>
<li><code>$2</code> contains the substring matched by the <em>second</em> subpattern, and so forth</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;My phone number is (456) 193-8123.&#34;</span>
regex <span style="color:#f92672">=</span> <span style="color:#e6db74">/\((\d{3})\)\s+(\d{3})-(\d{4})/</span>
m <span style="color:#f92672">=</span> regex<span style="color:#f92672">.</span>match(line) <span style="color:#75715e"># #&lt;MatchData &#34;(456) 193-8123&#34; 1:&#34;456&#34; 2:&#34;193&#34; 3:&#34;8123&#34;&gt;</span>
m<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;(456) 193-8123&#34;</span>
m<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;456&#34;</span>
m<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;193&#34;</span>
m<span style="color:#f92672">[</span><span style="color:#ae81ff">3</span><span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;8123&#34;</span>

<span style="color:#f92672">&gt;&gt;</span> <span style="color:#e6db74">/((a)((b)c))/</span><span style="color:#f92672">.</span>match(<span style="color:#e6db74">&#34;abc&#34;</span>)
<span style="color:#f92672">=&gt;</span> <span style="color:#75715e">#&lt;MatchData &#34;abc&#34; 1:&#34;abc&#34; 2:&#34;a&#34; 3:&#34;bc&#34; 4:&#34;b&#34;&gt;</span>
</code></pre></div><h2 id="file-and-io">File and IO</h2>
<p>The <code>IO</code> class handles all input and output streams either by itself or via its descendant classes, particularly <code>File</code>.</p>
<ul>
<li><code>STDERR</code>, <code>STDIN</code> and <code>STDOUT</code> are automatically set when the program starts</li>
<li>if an <code>IO</code> object is open for writing, it responds to <code>puts</code></li>
<li>whatever <code>puts</code> is given will be written to that <code>IO</code> object&rsquo;s output stream</li>
<li><code>IO</code> objects are enumerable</li>
<li>three global variables exist <code>$stdin</code>, <code>$stdout</code> and <code>$stderr</code>, can be reassigned</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">STDIN</span><span style="color:#f92672">.</span>select {<span style="color:#f92672">|</span>line<span style="color:#f92672">|</span> line <span style="color:#f92672">=~</span> <span style="color:#e6db74">/\A[A-Z]/</span> }
<span style="color:#66d9ef">We</span><span style="color:#e6db74">&#39;re only interested in
</span><span style="color:#e6db74">lines that begin with
</span><span style="color:#e6db74">Uppercase letters
</span><span style="color:#e6db74">=&gt; [&#34;We&#39;</span>re only interested <span style="color:#66d9ef">in</span>\n<span style="color:#e6db74">&#34;, &#34;</span><span style="color:#66d9ef">Uppercase</span> letters\n<span style="color:#e6db74">&#34;]
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">record = File.open(&#34;</span><span style="color:#f92672">/</span>tmp<span style="color:#f92672">/</span>record<span style="color:#e6db74">&#34;, &#34;</span>w<span style="color:#e6db74">&#34;)
</span><span style="color:#e6db74">old_stdout = $stdout
</span><span style="color:#e6db74">$stdout = record
</span><span style="color:#e6db74">$stderr = $stdout
</span><span style="color:#e6db74">puts &#34;</span>Z record<span style="color:#e6db74">&#34; # written to /tmp/record
</span><span style="color:#e6db74">z = 10 / 0 # written to /tmp/record
</span></code></pre></div>
</main>

<footer>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5504633517481956"
     data-ad-slot="4142928173"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>



<div id="disqus_thread"></div>
<script>


var disqus_config = function () {
this.page.url = "https:\/\/www.haozhexu.me\/article\/2020\/ruby\/";  
this.page.identifier = "https:\/\/www.haozhexu.me\/article\/2020\/ruby\/"; 
};
(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://haozhexu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




<hr/>
© <a href="https://www.haozhexu.me">Haozhe XU</a> 2017

</footer>
</body>
</html>
